<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ระบบจัดตารางสอนแทน O-NET</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Sarabun -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap" rel="stylesheet">
    <!-- html2canvas library for exporting -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    <style>
        body {
            font-family: 'Sarabun', sans-serif;
        }
        /* Style the date picker icon */
        input[type="date"]::-webkit-calendar-picker-indicator {
            cursor: pointer;
            filter: invert(0.6) sepia(0.5) saturate(5) hue-rotate(200deg);
        }
        /* Style for the buttons */
        .action-button {
            @apply inline-flex items-center justify-center px-5 py-2.5 text-base font-medium text-center text-white rounded-lg shadow-md transition duration-150 ease-in-out focus:ring-4 focus:outline-none;
        }
        .export-button {
             @apply bg-green-600 hover:bg-green-700 focus:ring-green-300;
        }
        .share-button {
             @apply bg-blue-600 hover:bg-blue-700 focus:ring-blue-300;
        }
         /* Simple toast notification style */
        #toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #333;
            color: #fff;
            padding: 10px 20px;
            border-radius: 5px;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
            z-index: 1000;
            max-width: 90%;
            text-align: center;
        }
        #toast.show {
            opacity: 1;
        }
        /* Ensure the date input itself is centered */
        #date-picker-container {
            display: flex;
            justify-content: center;
        }
        input[type="date"] {
             @apply w-auto max-w-xs p-3 border border-slate-300 rounded-lg text-lg text-center shadow-sm focus:ring-indigo-500 focus:border-indigo-500;
        }
        /* Tab Styles */
        .tab-button {
            @apply px-4 py-2 text-lg font-medium border-b-2 border-transparent hover:border-indigo-500 hover:text-indigo-600 focus:outline-none transition duration-150 ease-in-out;
        }
        .tab-button.active {
            @apply border-indigo-500 text-indigo-600;
        }
        .tab-content {
            display: none; /* Hidden by default */
        }
        .tab-content.active {
            display: block; /* Shown when active */
        }
    </style>
</head>
<body class="bg-slate-100">

    <div class="min-h-screen p-4 md:p-8">
        <!-- Main container -->
        <div class="max-w-4xl mx-auto bg-white p-6 md:p-8 rounded-2xl shadow-lg">
            <h1 class="text-3xl font-bold text-center text-indigo-800 mb-6">
                ระบบจัดตารางสอนแทน O-NET
            </h1>

            <div class="mb-8 text-center">
                <label for="date-picker" class="block text-lg font-medium text-slate-700 mb-3">
                    กรุณาเลือกวันที่
                </label>
                <div id="date-picker-container">
                    <input
                        type="date"
                        id="date-picker"
                        value="2025-11-10" <!-- Set default date -->
                    >
                </div>
            </div>

             <!-- Action Buttons -->
             <div class="flex flex-col sm:flex-row justify-center items-center space-y-3 sm:space-y-0 sm:space-x-4 mb-8">
                <button id="export-btn" class="action-button export-button w-full sm:w-auto">
                    <i class="fas fa-file-export mr-2"></i> Export ตารางเรียน (JPG)
                </button>
                <button id="share-btn" class="action-button share-button w-full sm:w-auto">
                   <i class="fas fa-share-square mr-2"></i> แชร์ตารางเรียน
                </button>
            </div>

            <hr class="my-8" />

            <!-- Tabs -->
            <div class="mb-4 border-b border-gray-200">
 <nav class="-mb-px flex justify-center space-x-8" aria-label="Tabs">
    <button id="tab-teacher" class="tab-button active" data-tab="teacher-schedule">
        ตารางสอนแทน (สำหรับครู)
    </button>
    <button id="tab-student" class="tab-button" data-tab="student-schedule">
        ตารางเรียน (สำหรับนักเรียน)
    </button>
    <button id="tab-summary" class="tab-button" data-tab="summary">
        <i class="fas fa-chart-bar mr-2"></i> สรุปชั่วโมงสอน
    </button>
</nav>
            </div>

            <!-- Tab Content Area -->
            <div>
                <!-- Teacher Schedule Content -->
                <div id="teacher-schedule-content" class="tab-content active space-y-6 bg-white p-1">
                    <h3 id="teacher-schedule-header" class="text-2xl font-bold text-center text-indigo-700 mb-6"></h3>
                    <div id="teacher-schedule-details">
                         <!-- Teacher details will be rendered here -->
                    </div>
                    <p id="teacher-schedule-nodata" class="text-center text-slate-500 text-xl font-medium py-8 hidden"></p>
                </div>

                <!-- Student Schedule Content -->
<div id="student-schedule-content" class="tab-content space-y-6 bg-white p-1">
   <h3 id="student-schedule-header" class="text-2xl font-bold text-center text-indigo-700 mb-6"></h3>
   <div id="student-schedule-details">
       </div>
   <p id="student-schedule-nodata" class="text-center text-slate-500 text-xl font-medium py-8 hidden"></p>
</div>

        <div id="summary-content" class="tab-content space-y-6 bg-white p-1">
           <h3 id="summary-schedule-header" class="text-2xl font-bold text-center text-indigo-700 mb-6"></h3>
           <div id="summary-schedule-details" class="overflow-x-auto">
               </div>
           <p id="summary-schedule-nodata" class="text-center text-slate-500 text-xl font-medium py-8 hidden"></p>
        </div>
    </div>
            </div>

        </div>
    </div>

    <!-- Toast Notification Element -->
    <div id="toast">ข้อความแจ้งเตือน</div>

    <script>
        // --- DATABASE: O-NET Schedule (Updated Times) ---
        const onetData = {
          "10/11/2568": [
            { periods: [1, 2, 3], subject: 'ภาษาอังกฤษ', grade: 'ป.6', teacher: 'ครูอรุณลักษณ์ การกระสัง', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'คณิตศาสตร์', grade: 'ป.6', teacher: 'ครูอมรเทพ จันทร์ครบ', time: '12:30 - 16:00 น.' },
            { periods: [1, 2, 3], subject: 'วิทยาศาสตร์', grade: 'ม.3', teacher: 'ครูณัฐชนม์ วงศ์มา', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'ภาษาไทย', grade: 'ม.3', teacher: 'ครูดำเนิน ว่าดี', time: '12:30 - 16:00 น.' }
          ],
          "11/11/2568": [
            { periods: [1, 2, 3], subject: 'ภาษาไทย', grade: 'ป.6', teacher: 'ครูดำเนิน ว่าดี', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'วิทยาศาสตร์', grade: 'ป.6', teacher: 'ครูณัฐชนม์ วงศ์มา', time: '12:30 - 16:00 น.' },
            { periods: [1, 2, 3], subject: 'คณิตศาสตร์', grade: 'ม.3', teacher: 'ครูอมรเทพ จันทร์ครบ', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'ภาษาอังกฤษ', grade: 'ม.3', teacher: 'ครูสายรุ้ง เรืองสุขสุด', time: '12:30 - 16:00 น.' }
          ],
           "12/11/2568": [
            { periods: [1, 2, 3], subject: 'คณิตศาสตร์', grade: 'ป.6', teacher: 'ครูอมรเทพ จันทร์ครบ', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'ภาษาอังกฤษ', grade: 'ป.6', teacher: 'ครูอรุณลักษณ์ การกระสัง', time: '12:30 - 16:00 น.' },
            { periods: [1, 2, 3], subject: 'ภาษาไทย', grade: 'ม.3', teacher: 'ครูดำเนิน ว่าดี', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'วิทยาศาสตร์', grade: 'ม.3', teacher: 'ครูณัฐชนม์ วงศ์มา', time: '12:30 - 16:00 น.' }
          ],
          "13/11/2568": [
            { periods: [1, 2, 3], subject: 'วิทยาศาสตร์', grade: 'ป.6', teacher: 'ครูณัฐชนม์ วงศ์มา', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'ภาษาไทย', grade: 'ป.6', teacher: 'ครูดำเนิน ว่าดี', time: '12:30 - 16:00 น.' },
            { periods: [1, 2, 3], subject: 'ภาษาอังกฤษ', grade: 'ม.3', teacher: 'ครูสายรุ้ง เรืองสุขสุด', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'คณิตศาสตร์', grade: 'ม.3', teacher: 'ครูอมรเทพ จันทร์ครบ', time: '12:30 - 16:00 น.' }
          ],
          "14/11/2568": [
            { periods: [1, 2, 3], subject: 'ภาษาอังกฤษ', grade: 'ป.6', teacher: 'ครูอรุณลักษณ์ การกระสัง', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'คณิตศาสตร์', grade: 'ป.6', teacher: 'ครูอมรเทพ จันทร์ครบ', time: '12:30 - 16:00 น.' },
            { periods: [1, 2, 3], subject: 'วิทยาศาสตร์', grade: 'ม.3', teacher: 'ครูณัฐชนม์ วงศ์มา', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'ภาษาไทย', grade: 'ม.3', teacher: 'ครูดำเนิน ว่าดี', time: '12:30 - 16:00 น.' }
          ],
          // ... (Rest of the onetData remains the same) ...
           "17/11/2568": [
            { periods: [1, 2, 3], subject: 'ภาษาไทย', grade: 'ป.6', teacher: 'ครูดำเนิน ว่าดี', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'วิทยาศาสตร์', grade: 'ป.6', teacher: 'ครูณัฐชนม์ วงศ์มา', time: '12:30 - 16:00 น.' },
            { periods: [1, 2, 3], subject: 'คณิตศาสตร์', grade: 'ม.3', teacher: 'ครูอมรเทพ จันทร์ครบ', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'ภาษาอังกฤษ', grade: 'ม.3', teacher: 'ครูสายรุ้ง เรืองสุขสุด', time: '12:30 - 16:00 น.' }
          ],
          "18/11/2568": [
            { periods: [1, 2, 3], subject: 'คณิตศาสตร์', grade: 'ป.6', teacher: 'ครูอมรเทพ จันทร์ครบ', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'ภาษาอังกฤษ', grade: 'ป.6', teacher: 'ครูอรุณลักษณ์ การกระสัง', time: '12:30 - 16:00 น.' },
            { periods: [1, 2, 3], subject: 'ภาษาไทย', grade: 'ม.3', teacher: 'ครูดำเนิน ว่าดี', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'วิทยาศาสตร์', grade: 'ม.3', teacher: 'ครูณัฐชนม์ วงศ์มา', time: '12:30 - 16:00 น.' }
          ],
          "19/11/2568": [
            { periods: [1, 2, 3], subject: 'วิทยาศาสตร์', grade: 'ป.6', teacher: 'ครูณัฐชนม์ วงศ์มา', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'ภาษาไทย', grade: 'ป.6', teacher: 'ครูดำเนิน ว่าดี', time: '12:30 - 16:00 น.' },
            { periods: [1, 2, 3], subject: 'ภาษาอังกฤษ', grade: 'ม.3', teacher: 'ครูสายรุ้ง เรืองสุขสุด', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'คณิตศาสตร์', grade: 'ม.3', teacher: 'ครูอมรเทพ จันทร์ครบ', time: '12:30 - 16:00 น.' }
          ],
          "20/11/2568": [
            { periods: [1, 2, 3], subject: 'ภาษาอังกฤษ', grade: 'ป.6', teacher: 'ครูอรุณลักษณ์ การกระสัง', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'คณิตศาสตร์', grade: 'ป.6', teacher: 'ครูอมรเทพ จันทร์ครบ', time: '12:30 - 16:00 น.' },
            { periods: [1, 2, 3], subject: 'วิทยาศาสตร์', grade: 'ม.3', teacher: 'ครูณัฐชนม์ วงศ์มา', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'ภาษาไทย', grade: 'ม.3', teacher: 'ครูดำเนิน ว่าดี', time: '12:30 - 16:00 น.' }
          ],
          "21/11/2568": [
            { periods: [1, 2, 3], subject: 'ภาษาไทย', grade: 'ป.6', teacher: 'ครูดำเนิน ว่าดี', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'วิทยาศาสตร์', grade: 'ป.6', teacher: 'ครูณัฐชนม์ วงศ์มา', time: '12:30 - 16:00 น.' },
            { periods: [1, 2, 3], subject: 'คณิตศาสตร์', grade: 'ม.3', teacher: 'ครูอมรเทพ จันทร์ครบ', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'ภาษาอังกฤษ', grade: 'ม.3', teacher: 'ครูสายรุ้ง เรืองสุขสุด', time: '12:30 - 16:00 น.' }
          ],
           "24/11/2568": [
            { periods: [1, 2, 3], subject: 'คณิตศาสตร์', grade: 'ป.6', teacher: 'ครูอมรเทพ จันทร์ครบ', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'ภาษาอังกฤษ', grade: 'ป.6', teacher: 'ครูอรุณลักษณ์ การกระสัง', time: '12:30 - 16:00 น.' },
            { periods: [1, 2, 3], subject: 'ภาษาไทย', grade: 'ม.3', teacher: 'ครูดำเนิน ว่าดี', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'วิทยาศาสตร์', grade: 'ม.3', teacher: 'ครูณัฐชนม์ วงศ์มา', time: '12:30 - 16:00 น.' }
          ],
          "25/11/2568": [
            { periods: [1, 2, 3], subject: 'วิทยาศาสตร์', grade: 'ป.6', teacher: 'ครูณัฐชนม์ วงศ์มา', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'ภาษาไทย', grade: 'ป.6', teacher: 'ครูดำเนิน ว่าดี', time: '12:30 - 16:00 น.' },
            { periods: [1, 2, 3], subject: 'ภาษาอังกฤษ', grade: 'ม.3', teacher: 'ครูสายรุ้ง เรืองสุขสุด', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'คณิตศาสตร์', grade: 'ม.3', teacher: 'ครูอมรเทพ จันทร์ครบ', time: '12:30 - 16:00 น.' }
          ],
          "26/11/2568": [
            { periods: [1, 2, 3], subject: 'ภาษาอังกฤษ', grade: 'ป.6', teacher: 'ครูอรุณลักษณ์ การกระสัง', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'คณิตศาสตร์', grade: 'ป.6', teacher: 'ครูอมรเทพ จันทร์ครบ', time: '12:30 - 16:00 น.' },
            { periods: [1, 2, 3], subject: 'วิทยาศาสตร์', grade: 'ม.3', teacher: 'ครูณัฐชนม์ วงศ์มา', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'ภาษาไทย', grade: 'ม.3', teacher: 'ครูดำเนิน ว่าดี', time: '12:30 - 16:00 น.' }
          ],
          "27/11/2568": [
            { periods: [1, 2, 3], subject: 'ภาษาไทย', grade: 'ป.6', teacher: 'ครูดำเนิน ว่าดี', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'วิทยาศาสตร์', grade: 'ป.6', teacher: 'ครูณัฐชนม์ วงศ์มา', time: '12:30 - 16:00 น.' },
            { periods: [1, 2, 3], subject: 'คณิตศาสตร์', grade: 'ม.3', teacher: 'ครูอมรเทพ จันทร์ครบ', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'ภาษาอังกฤษ', grade: 'ม.3', teacher: 'ครูสายรุ้ง เรืองสุขสุด', time: '12:30 - 16:00 น.' }
          ],
          "28/11/2568": [
            { periods: [1, 2, 3], subject: 'คณิตศาสตร์', grade: 'ป.6', teacher: 'ครูอมรเทพ จันทร์ครบ', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'ภาษาอังกฤษ', grade: 'ป.6', teacher: 'ครูอรุณลักษณ์ การกระสัง', time: '12:30 - 16:00 น.' },
            { periods: [1, 2, 3], subject: 'ภาษาไทย', grade: 'ม.3', teacher: 'ครูดำเนิน ว่าดี', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'วิทยาศาสตร์', grade: 'ม.3', teacher: 'ครูณัฐชนม์ วงศ์มา', time: '12:30 - 16:00 น.' }
          ],
          "01/12/2568": [
            { periods: [1, 2, 3], subject: 'วิทยาศาสตร์', grade: 'ป.6', teacher: 'ครูณัฐชนม์ วงศ์มา', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'ภาษาไทย', grade: 'ป.6', teacher: 'ครูดำเนิน ว่าดี', time: '12:30 - 16:00 น.' },
            { periods: [1, 2, 3], subject: 'ภาษาอังกฤษ', grade: 'ม.3', teacher: 'ครูสายรุ้ง เรืองสุขสุด', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'คณิตศาสตร์', grade: 'ม.3', teacher: 'ครูอมรเทพ จันทร์ครบ', time: '12:30 - 16:00 น.' }
          ],
          "02/12/2568": [
            { periods: [1, 2, 3], subject: 'ภาษาอังกฤษ', grade: 'ป.6', teacher: 'ครูอรุณลักษณ์ การกระสัง', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'คณิตศาสตร์', grade: 'ป.6', teacher: 'ครูอมรเทพ จันทร์ครบ', time: '12:30 - 16:00 น.' },
            { periods: [1, 2, 3], subject: 'วิทยาศาสตร์', grade: 'ม.3', teacher: 'ครูณัฐชนม์ วงศ์มา', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'ภาษาไทย', grade: 'ม.3', teacher: 'ครูดำเนิน ว่าดี', time: '12:30 - 16:00 น.' }
          ],
          "03/12/2568": [
            { periods: [1, 2, 3], subject: 'ภาษาไทย', grade: 'ป.6', teacher: 'ครูดำเนิน ว่าดี', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'วิทยาศาสตร์', grade: 'ป.6', teacher: 'ครูณัฐชนม์ วงศ์มา', time: '12:30 - 16:00 น.' },
            { periods: [1, 2, 3], subject: 'คณิตศาสตร์', grade: 'ม.3', teacher: 'ครูอมรเทพ จันทร์ครบ', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'ภาษาอังกฤษ', grade: 'ม.3', teacher: 'ครูสายรุ้ง เรืองสุขสุด', time: '12:30 - 16:00 น.' }
          ],
          "04/12/2568": [
            { periods: [1, 2, 3], subject: 'คณิตศาสตร์', grade: 'ป.6', teacher: 'ครูอมรเทพ จันทร์ครบ', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'ภาษาอังกฤษ', grade: 'ป.6', teacher: 'ครูอรุณลักษณ์ การกระสัง', time: '12:30 - 16:00 น.' },
            { periods: [1, 2, 3], subject: 'ภาษาไทย', grade: 'ม.3', teacher: 'ครูดำเนิน ว่าดี', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'วิทยาศาสตร์', grade: 'ม.3', teacher: 'ครูณัฐชนม์ วงศ์มา', time: '12:30 - 16:00 น.' }
          ],
          "08/12/2568": [
            { periods: [1, 2, 3], subject: 'วิทยาศาสตร์', grade: 'ป.6', teacher: 'ครูณัฐชนม์ วงศ์มา', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'ภาษาไทย', grade: 'ป.6', teacher: 'ครูดำเนิน ว่าดี', time: '12:30 - 16:00 น.' },
            { periods: [1, 2, 3], subject: 'ภาษาอังกฤษ', grade: 'ม.3', teacher: 'ครูสายรุ้ง เรืองสุขสุด', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'คณิตศาสตร์', grade: 'ม.3', teacher: 'ครูอมรเทพ จันทร์ครบ', time: '12:30 - 16:00 น.' }
          ],
          "09/12/2568": [
            { periods: [1, 2, 3], subject: 'ภาษาอังกฤษ', grade: 'ป.6', teacher: 'ครูอรุณลักษณ์ การกระสัง', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'คณิตศาสตร์', grade: 'ป.6', teacher: 'ครูอมรเทพ จันทร์ครบ', time: '12:30 - 16:00 น.' },
            { periods: [1, 2, 3], subject: 'วิทยาศาสตร์', grade: 'ม.3', teacher: 'ครูณัฐชนม์ วงศ์มา', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'ภาษาไทย', grade: 'ม.3', teacher: 'ครูดำเนิน ว่าดี', time: '12:30 - 16:00 น.' }
          ],
           "11/12/2568": [
            { periods: [1, 2, 3], subject: 'ภาษาไทย', grade: 'ป.6', teacher: 'ครูดำเนิน ว่าดี', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'วิทยาศาสตร์', grade: 'ป.6', teacher: 'ครูณัฐชนม์ วงศ์มา', time: '12:30 - 16:00 น.' },
            { periods: [1, 2, 3], subject: 'คณิตศาสตร์', grade: 'ม.3', teacher: 'ครูอมรเทพ จันทร์ครบ', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'ภาษาอังกฤษ', grade: 'ม.3', teacher: 'ครูสายรุ้ง เรืองสุขสุด', time: '12:30 - 16:00 น.' }
          ],
          "12/12/2568": [
            { periods: [1, 2, 3], subject: 'คณิตศาสตร์', grade: 'ป.6', teacher: 'ครูอมรเทพ จันทร์ครบ', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'ภาษาอังกฤษ', grade: 'ป.6', teacher: 'ครูอรุณลักษณ์ การกระสัง', time: '12:30 - 16:00 น.' },
            { periods: [1, 2, 3], subject: 'ภาษาไทย', grade: 'ม.3', teacher: 'ครูดำเนิน ว่าดี', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'วิทยาศาสตร์', grade: 'ม.3', teacher: 'ครูณัฐชนม์ วงศ์มา', time: '12:30 - 16:00 น.' }
          ],
          "15/12/2568": [
            { periods: [1, 2, 3], subject: 'วิทยาศาสตร์', grade: 'ป.6', teacher: 'ครูณัฐชนม์ วงศ์มา', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'ภาษาไทย', grade: 'ป.6', teacher: 'ครูดำเนิน ว่าดี', time: '12:30 - 16:00 น.' },
            { periods: [1, 2, 3], subject: 'ภาษาอังกฤษ', grade: 'ม.3', teacher: 'ครูสายรุ้ง เรืองสุขสุด', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'คณิตศาสตร์', grade: 'ม.3', teacher: 'ครูอมรเทพ จันทร์ครบ', time: '12:30 - 16:00 น.' }
          ],
          "16/12/2568": [
            { periods: [1, 2, 3], subject: 'ภาษาอังกฤษ', grade: 'ป.6', teacher: 'ครูอรุณลักษณ์ การกระสัง', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'คณิตศาสตร์', grade: 'ป.6', teacher: 'ครูอมรเทพ จันทร์ครบ', time: '12:30 - 16:00 น.' },
            { periods: [1, 2, 3], subject: 'วิทยาศาสตร์', grade: 'ม.3', teacher: 'ครูณัฐชนม์ วงศ์มา', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'ภาษาไทย', grade: 'ม.3', teacher: 'ครูดำเนิน ว่าดี', time: '12:30 - 16:00 น.' }
          ],
          "17/12/2568": [
            { periods: [1, 2, 3], subject: 'ภาษาไทย', grade: 'ป.6', teacher: 'ครูดำเนิน ว่าดี', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'วิทยาศาสตร์', grade: 'ป.6', teacher: 'ครูณัฐชนม์ วงศ์มา', time: '12:30 - 16:00 น.' },
            { periods: [1, 2, 3], subject: 'คณิตศาสตร์', grade: 'ม.3', teacher: 'ครูอมรเทพ จันทร์ครบ', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'ภาษาอังกฤษ', grade: 'ม.3', teacher: 'ครูสายรุ้ง เรืองสุขสุด', time: '12:30 - 16:00 น.' }
          ],
          "18/12/2568": [
            { periods: [1, 2, 3], subject: 'คณิตศาสตร์', grade: 'ป.6', teacher: 'ครูอมรเทพ จันทร์ครบ', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'ภาษาอังกฤษ', grade: 'ป.6', teacher: 'ครูอรุณลักษณ์ การกระสัง', time: '12:30 - 16:00 น.' },
            { periods: [1, 2, 3], subject: 'ภาษาไทย', grade: 'ม.3', teacher: 'ครูดำเนิน ว่าดี', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'วิทยาศาสตร์', grade: 'ม.3', teacher: 'ครูณัฐชนม์ วงศ์มา', time: '12:30 - 16:00 น.' }
          ],
           "19/12/2568": [
            { periods: [1, 2, 3], subject: 'วิทยาศาสตร์', grade: 'ป.6', teacher: 'ครูณัฐชนม์ วงศ์มา', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'ภาษาไทย', grade: 'ป.6', teacher: 'ครูดำเนิน ว่าดี', time: '12:30 - 16:00 น.' },
            { periods: [1, 2, 3], subject: 'ภาษาอังกฤษ', grade: 'ม.3', teacher: 'ครูสายรุ้ง เรืองสุขสุด', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'คณิตศาสตร์', grade: 'ม.3', teacher: 'ครูอมรเทพ จันทร์ครบ', time: '12:30 - 16:00 น.' }
          ],
          "22/12/2568": [
            { periods: [1, 2, 3], subject: 'ภาษาอังกฤษ', grade: 'ป.6', teacher: 'ครูอรุณลักษณ์ การกระสัง', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'คณิตศาสตร์', grade: 'ป.6', teacher: 'ครูอมรเทพ จันทร์ครบ', time: '12:30 - 16:00 น.' },
            { periods: [1, 2, 3], subject: 'วิทยาศาสตร์', grade: 'ม.3', teacher: 'ครูณัฐชนม์ วงศ์มา', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'ภาษาไทย', grade: 'ม.3', teacher: 'ครูดำเนิน ว่าดี', time: '12:30 - 16:00 น.' }
          ],
          "23/12/2568": [
            { periods: [1, 2, 3], subject: 'ภาษาไทย', grade: 'ป.6', teacher: 'ครูดำเนิน ว่าดี', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'วิทยาศาสตร์', grade: 'ป.6', teacher: 'ครูณัฐชนม์ วงศ์มา', time: '12:30 - 16:00 น.' },
            { periods: [1, 2, 3], subject: 'คณิตศาสตร์', grade: 'ม.3', teacher: 'ครูอมรเทพ จันทร์ครบ', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'ภาษาอังกฤษ', grade: 'ม.3', teacher: 'ครูสายรุ้ง เรืองสุขสุด', time: '12:30 - 16:00 น.' }
          ],
          "24/12/2568": [
            { periods: [1, 2, 3], subject: 'คณิตศาสตร์', grade: 'ป.6', teacher: 'ครูอมรเทพ จันทร์ครบ', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'ภาษาอังกฤษ', grade: 'ป.6', teacher: 'ครูอรุณลักษณ์ การกระสัง', time: '12:30 - 16:00 น.' },
            { periods: [1, 2, 3], subject: 'ภาษาไทย', grade: 'ม.3', teacher: 'ครูดำเนิน ว่าดี', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'วิทยาศาสตร์', grade: 'ม.3', teacher: 'ครูณัฐชนม์ วงศ์มา', time: '12:30 - 16:00 น.' }
          ],
          "25/12/2568": [
            { periods: [1, 2, 3], subject: 'วิทยาศาสตร์', grade: 'ป.6', teacher: 'ครูณัฐชนม์ วงศ์มา', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'ภาษาไทย', grade: 'ป.6', teacher: 'ครูดำเนิน ว่าดี', time: '12:30 - 16:00 น.' },
            { periods: [1, 2, 3], subject: 'ภาษาอังกฤษ', grade: 'ม.3', teacher: 'ครูสายรุ้ง เรืองสุขสุด', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'คณิตศาสตร์', grade: 'ม.3', teacher: 'ครูอมรเทพ จันทร์ครบ', time: '12:30 - 16:00 น.' }
          ],
           "29/12/2568": [
            { periods: [1, 2, 3], subject: 'ภาษาอังกฤษ', grade: 'ป.6', teacher: 'ครูอรุณลักษณ์ การกระสัง', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'คณิตศาสตร์', grade: 'ป.6', teacher: 'ครูอมรเทพ จันทร์ครบ', time: '12:30 - 16:00 น.' },
            { periods: [1, 2, 3], subject: 'วิทยาศาสตร์', grade: 'ม.3', teacher: 'ครูณัฐชนม์ วงศ์มา', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'ภาษาไทย', grade: 'ม.3', teacher: 'ครูดำเนิน ว่าดี', time: '12:30 - 16:00 น.' }
          ],
          "30/12/2568": [
            { periods: [1, 2, 3], subject: 'ภาษาไทย', grade: 'ป.6', teacher: 'ครูดำเนิน ว่าดี', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'วิทยาศาสตร์', grade: 'ป.6', teacher: 'ครูณัฐชนม์ วงศ์มา', time: '12:30 - 16:00 น.' },
            { periods: [1, 2, 3], subject: 'คณิตศาสตร์', grade: 'ม.3', teacher: 'ครูอมรเทพ จันทร์ครบ', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'ภาษาอังกฤษ', grade: 'ม.3', teacher: 'ครูสายรุ้ง เรืองสุขสุด', time: '12:30 - 16:00 น.' }
          ],
          "31/12/2568": [
            { periods: [1, 2, 3], subject: 'คณิตศาสตร์', grade: 'ป.6', teacher: 'ครูอมรเทพ จันทร์ครบ', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'ภาษาอังกฤษ', grade: 'ป.6', teacher: 'ครูอรุณลักษณ์ การกระสัง', time: '12:30 - 16:00 น.' },
            { periods: [1, 2, 3], subject: 'ภาษาไทย', grade: 'ม.3', teacher: 'ครูดำเนิน ว่าดี', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'วิทยาศาสตร์', grade: 'ม.3', teacher: 'ครูณัฐชนม์ วงศ์มา', time: '12:30 - 16:00 น.' }
          ],
          "06/01/2569": [
            { periods: [1, 2, 3], subject: 'วิทยาศาสตร์', grade: 'ป.6', teacher: 'ครูณัฐชนม์ วงศ์มา', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'ภาษาไทย', grade: 'ป.6', teacher: 'ครูดำเนิน ว่าดี', time: '12:30 - 16:00 น.' },
            { periods: [1, 2, 3], subject: 'ภาษาอังกฤษ', grade: 'ม.3', teacher: 'ครูสายรุ้ง เรืองสุขสุด', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'คณิตศาสตร์', grade: 'ม.3', teacher: 'ครูอมรเทพ จันทร์ครบ', time: '12:30 - 16:00 น.' }
          ],
          "07/01/2569": [
            { periods: [1, 2, 3], subject: 'ภาษาอังกฤษ', grade: 'ป.6', teacher: 'ครูอรุณลักษณ์ การกระสัง', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'คณิตศาสตร์', grade: 'ป.6', teacher: 'ครูอมรเทพ จันทร์ครบ', time: '12:30 - 16:00 น.' },
            { periods: [1, 2, 3], subject: 'วิทยาศาสตร์', grade: 'ม.3', teacher: 'ครูณัฐชนม์ วงศ์มา', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'ภาษาไทย', grade: 'ม.3', teacher: 'ครูดำเนิน ว่าดี', time: '12:30 - 16:00 น.' }
          ],
           "08/01/2569": [
            { periods: [1, 2, 3], subject: 'ภาษาไทย', grade: 'ป.6', teacher: 'ครูดำเนิน ว่าดี', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'วิทยาศาสตร์', grade: 'ป.6', teacher: 'ครูณัฐชนม์ วงศ์มา', time: '12:30 - 16:00 น.' },
            { periods: [1, 2, 3], subject: 'คณิตศาสตร์', grade: 'ม.3', teacher: 'ครูอมรเทพ จันทร์ครบ', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'ภาษาอังกฤษ', grade: 'ม.3', teacher: 'ครูสายรุ้ง เรืองสุขสุด', time: '12:30 - 16:00 น.' }
          ],
          "09/01/2569": [
            { periods: [1, 2, 3], subject: 'คณิตศาสตร์', grade: 'ป.6', teacher: 'ครูอมรเทพ จันทร์ครบ', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'ภาษาอังกฤษ', grade: 'ป.6', teacher: 'ครูอรุณลักษณ์ การกระสัง', time: '12:30 - 16:00 น.' },
            { periods: [1, 2, 3], subject: 'ภาษาไทย', grade: 'ม.3', teacher: 'ครูดำเนิน ว่าดี', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'วิทยาศาสตร์', grade: 'ม.3', teacher: 'ครูณัฐชนม์ วงศ์มา', time: '12:30 - 16:00 น.' }
          ],
          "12/01/2569": [
            { periods: [1, 2, 3], subject: 'วิทยาศาสตร์', grade: 'ป.6', teacher: 'ครูณัฐชนม์ วงศ์มา', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'ภาษาไทย', grade: 'ป.6', teacher: 'ครูดำเนิน ว่าดี', time: '12:30 - 16:00 น.' },
            { periods: [1, 2, 3], subject: 'ภาษาอังกฤษ', grade: 'ม.3', teacher: 'ครูสายรุ้ง เรืองสุขสุด', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'คณิตศาสตร์', grade: 'ม.3', teacher: 'ครูอมรเทพ จันทร์ครบ', time: '12:30 - 16:00 น.' }
          ],
          "13/01/2569": [
            { periods: [1, 2, 3], subject: 'ภาษาอังกฤษ', grade: 'ป.6', teacher: 'ครูอรุณลักษณ์ การกระสัง', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'คณิตศาสตร์', grade: 'ป.6', teacher: 'ครูอมรเทพ จันทร์ครบ', time: '12:30 - 16:00 น.' },
            { periods: [1, 2, 3], subject: 'วิทยาศาสตร์', grade: 'ม.3', teacher: 'ครูณัฐชนม์ วงศ์มา', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'ภาษาไทย', grade: 'ม.3', teacher: 'ครูดำเนิน ว่าดี', time: '12:30 - 16:00 น.' }
          ],
          "14/01/2569": [
            { periods: [1, 2, 3], subject: 'ภาษาไทย', grade: 'ป.6', teacher: 'ครูดำเนิน ว่าดี', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'วิทยาศาสตร์', grade: 'ป.6', teacher: 'ครูณัฐชนม์ วงศ์มา', time: '12:30 - 16:00 น.' },
            { periods: [1, 2, 3], subject: 'คณิตศาสตร์', grade: 'ม.3', teacher: 'ครูอมรเทพ จันทร์ครบ', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'ภาษาอังกฤษ', grade: 'ม.3', teacher: 'ครูสายรุ้ง เรืองสุขสุด', time: '12:30 - 16:00 น.' }
          ],
           "15/01/2569": [
            { periods: [1, 2, 3], subject: 'คณิตศาสตร์', grade: 'ป.6', teacher: 'ครูอมรเทพ จันทร์ครบ', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'ภาษาอังกฤษ', grade: 'ป.6', teacher: 'ครูอรุณลักษณ์ การกระสัง', time: '12:30 - 16:00 น.' },
            { periods: [1, 2, 3], subject: 'ภาษาไทย', grade: 'ม.3', teacher: 'ครูดำเนิน ว่าดี', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'วิทยาศาสตร์', grade: 'ม.3', teacher: 'ครูณัฐชนม์ วงศ์มา', time: '12:30 - 16:00 น.' }
          ],
          "16/01/2569": [
            { periods: [1, 2, 3], subject: 'วิทยาศาสตร์', grade: 'ป.6', teacher: 'ครูณัฐชนม์ วงศ์มา', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'ภาษาไทย', grade: 'ป.6', teacher: 'ครูดำเนิน ว่าดี', time: '12:30 - 16:00 น.' },
            { periods: [1, 2, 3], subject: 'ภาษาอังกฤษ', grade: 'ม.3', teacher: 'ครูสายรุ้ง เรืองสุขสุด', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'คณิตศาสตร์', grade: 'ม.3', teacher: 'ครูอมรเทพ จันทร์ครบ', time: '12:30 - 16:00 น.' }
          ],
          "20/01/2569": [
            { periods: [1, 2, 3], subject: 'ภาษาอังกฤษ', grade: 'ป.6', teacher: 'ครูอรุณลักษณ์ การกระสัง', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'คณิตศาสตร์', grade: 'ป.6', teacher: 'ครูอมรเทพ จันทร์ครบ', time: '12:30 - 16:00 น.' },
            { periods: [1, 2, 3], subject: 'วิทยาศาสตร์', grade: 'ม.3', teacher: 'ครูณัฐชนม์ วงศ์มา', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'ภาษาไทย', grade: 'ม.3', teacher: 'ครูดำเนิน ว่าดี', time: '12:30 - 16:00 น.' }
          ],
          "21/01/2569": [
            { periods: [1, 2, 3], subject: 'ภาษาไทย', grade: 'ป.6', teacher: 'ครูดำเนิน ว่าดี', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'วิทยาศาสตร์', grade: 'ป.6', teacher: 'ครูณัฐชนม์ วงศ์มา', time: '12:30 - 16:00 น.' },
            { periods: [1, 2, 3], subject: 'คณิตศาสตร์', grade: 'ม.3', teacher: 'ครูอมรเทพ จันทร์ครบ', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'ภาษาอังกฤษ', grade: 'ม.3', teacher: 'ครูสายรุ้ง เรืองสุขสุด', time: '12:30 - 16:00 น.' }
          ],
          "22/01/2569": [
            { periods: [1, 2, 3], subject: 'คณิตศาสตร์', grade: 'ป.6', teacher: 'ครูอมรเทพ จันทร์ครบ', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'ภาษาอังกฤษ', grade: 'ป.6', teacher: 'ครูอรุณลักษณ์ การกระสัง', time: '12:30 - 16:00 น.' },
            { periods: [1, 2, 3], subject: 'ภาษาไทย', grade: 'ม.3', teacher: 'ครูดำเนิน ว่าดี', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'วิทยาศาสตร์', grade: 'ม.3', teacher: 'ครูณัฐชนม์ วงศ์มา', time: '12:30 - 16:00 น.' }
          ],
           "23/01/2569": [
            { periods: [1, 2, 3], subject: 'วิทยาศาสตร์', grade: 'ป.6', teacher: 'ครูณัฐชนม์ วงศ์มา', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'ภาษาไทย', grade: 'ป.6', teacher: 'ครูดำเนิน ว่าดี', time: '12:30 - 16:00 น.' },
            { periods: [1, 2, 3], subject: 'ภาษาอังกฤษ', grade: 'ม.3', teacher: 'ครูสายรุ้ง เรืองสุขสุด', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'คณิตศาสตร์', grade: 'ม.3', teacher: 'ครูอมรเทพ จันทร์ครบ', time: '12:30 - 16:00 น.' }
          ],
          "26/01/2569": [
            { periods: [1, 2, 3], subject: 'ภาษาอังกฤษ', grade: 'ป.6', teacher: 'ครูอรุณลักษณ์ การกระสัง', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'คณิตศาสตร์', grade: 'ป.6', teacher: 'ครูอมรเทพ จันทร์ครบ', time: '12:30 - 16:00 น.' },
            { periods: [1, 2, 3], subject: 'วิทยาศาสตร์', grade: 'ม.3', teacher: 'ครูณัฐชนม์ วงศ์มา', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'ภาษาไทย', grade: 'ม.3', teacher: 'ครูดำเนิน ว่าดี', time: '12:30 - 16:00 น.' }
          ],
          "27/01/2569": [
            { periods: [1, 2, 3], subject: 'ภาษาไทย', grade: 'ป.6', teacher: 'ครูดำเนิน ว่าดี', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'วิทยาศาสตร์', grade: 'ป.6', teacher: 'ครูณัฐชนม์ วงศ์มา', time: '12:30 - 16:00 น.' },
            { periods: [1, 2, 3], subject: 'คณิตศาสตร์', grade: 'ม.3', teacher: 'ครูอมรเทพ จันทร์ครบ', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'ภาษาอังกฤษ', grade: 'ม.3', teacher: 'ครูสายรุ้ง เรืองสุขสุด', time: '12:30 - 16:00 น.' }
          ],
          "28/01/2569": [
            { periods: [1, 2, 3], subject: 'คณิตศาสตร์', grade: 'ป.6', teacher: 'ครูอมรเทพ จันทร์ครบ', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'ภาษาอังกฤษ', grade: 'ป.6', teacher: 'ครูอรุณลักษณ์ การกระสัง', time: '12:30 - 16:00 น.' },
            { periods: [1, 2, 3], subject: 'ภาษาไทย', grade: 'ม.3', teacher: 'ครูดำเนิน ว่าดี', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'วิทยาศาสตร์', grade: 'ม.3', teacher: 'ครูณัฐชนม์ วงศ์มา', time: '12:30 - 16:00 น.' }
          ],
          "29/01/2569": [
            { periods: [1, 2, 3], subject: 'วิทยาศาสตร์', grade: 'ป.6', teacher: 'ครูณัฐชนม์ วงศ์มา', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'ภาษาไทย', grade: 'ป.6', teacher: 'ครูดำเนิน ว่าดี', time: '12:30 - 16:00 น.' },
            { periods: [1, 2, 3], subject: 'ภาษาอังกฤษ', grade: 'ม.3', teacher: 'ครูสายรุ้ง เรืองสุขสุด', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'คณิตศาสตร์', grade: 'ม.3', teacher: 'ครูอมรเทพ จันทร์ครบ', time: '12:30 - 16:00 น.' }
          ],
          "30/01/2569": [
            { periods: [1, 2, 3], subject: 'ภาษาอังกฤษ', grade: 'ป.6', teacher: 'ครูอรุณลักษณ์ การกระสัง', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'คณิตศาสตร์', grade: 'ป.6', teacher: 'ครูอมรเทพ จันทร์ครบ', time: '12:30 - 16:00 น.' },
            { periods: [1, 2, 3], subject: 'วิทยาศาสตร์', grade: 'ม.3', teacher: 'ครูณัฐชนม์ วงศ์มา', time: '08:00 - 11:30 น.' },
            { periods: [4, 5, 6], subject: 'ภาษาไทย', grade: 'ม.3', teacher: 'ครูดำเนิน ว่าดี', time: '12:30 - 16:00 น.' }
          ]
        };

        // --- DATABASE: Teacher Data & Schedules ---
        const allTeacherData = [
          // --- ครูติว O-NET ---
          {
            name: 'ครูณัฐชนม์ วงศ์มา',
            type: 'tutor',
            canTeachGrades: [],
            canTeachSpecial: null,
            schedule: {
              'วันจันทร์': [
                { period: 1, subject: 'วิทยาศาสตร์และเทคฯ', grade: 'ม.1' },
                { period: 2, subject: 'วิทยาศาสตร์และเทคฯ 6', grade: 'ป.6' },
                { period: 3, subject: 'วิทยาศาสตร์และเทคฯ 4', grade: 'ป.4' },
                { period: 4, subject: 'ซ่อมเสริม', grade: 'ป.5' },
                { period: 5, subject: 'วิทยาศาสตร์และเทคฯ', grade: 'ม.2' },
                { period: 6, subject: 'วางทุกงานอ่านทุกคน', grade: 'ป.5' }
              ],
              'วันอังคาร': [
                { period: 1, subject: 'วิทยาศาสตร์และเทคฯ 4', grade: 'ป.4' },
                { period: 2, subject: 'วิทยาศาสตร์และเทคฯ', grade: 'ม.2' },
                { period: 3, subject: 'วิทยาศาสตร์และเทคฯ 5', grade: 'ป.5' },
                { period: 4, subject: 'วิทยาศาสตร์และเทคฯ', grade: 'ม.1' },
                { period: 5, subject: null, grade: null },
                { period: 6, subject: null, grade: null }
              ],
              'วันพุธ': [
                { period: 1, subject: null, grade: null },
                { period: 2, subject: 'วิทยาศาสตร์และเทคฯ 6', grade: 'ป.6' },
                { period: 3, subject: null, grade: null },
                { period: 4, subject: 'วิทยาศาสตร์ฯ (เพิ่มเติม)', grade: 'ม.1' },
                { period: 5, subject: 'วิทยาศาสตร์และเทคฯ', grade: 'ม.3' },
                { period: 6, subject: 'ลูกเสือ', grade: null }
              ],
              'วันพฤหัสบดี': [
                { period: 1, subject: 'วิทยาศาสตร์และเทคฯ', grade: 'ม.3' },
                { period: 2, subject: null, grade: null },
                { period: 3, subject: 'สุขศึกษาและพลศึกษา 5', grade: 'ป.5' },
                { period: 4, subject: 'สุขศึกษาและพลศึกษา 4', grade: 'ป.4' },
                { period: 5, subject: 'วางทุกงานอ่านทุกคน', grade: 'ป.5' },
                { period: 6, subject: 'ชุมนุม', grade: null }
              ],
              'วันศุกร์': [
                { period: 1, subject: 'วิทยาศาสตร์ฯ (เพิ่มเติม)', grade: 'ม.2' },
                { period: 2, subject: 'วิทยาศาสตร์ฯ (เพิ่มเติม)', grade: 'ม.3' },
                { period: 3, subject: 'วิทยาศาสตร์และเทคฯ 5', grade: 'ป.5' },
                { period: 4, subject: null, grade: null },
                { period: 5, subject: null, grade: null },
                { period: 6, subject: 'PLC', grade: null }
              ]
            }
          },
          {
            name: 'ครูดำเนิน ว่าดี',
            type: 'tutor',
            canTeachGrades: [],
            canTeachSpecial: null,
            schedule: {
              'วันจันทร์': [
                { period: 1, subject: 'ภาษาไทย 6', grade: 'ป.6' },
                { period: 2, subject: 'ศิลปะ (ทัศนศิลป์)', grade: 'ม.3' },
                { period: 3, subject: 'ภาษาไทย', grade: 'ม.1' },
                { period: 4, subject: 'ภาษาไทย', grade: 'ม.2' },
                { period: 5, subject: 'ภาษาไทย', grade: 'ม.3' },
                { period: 6, subject: 'ศิลปะ (ดนตรี)', grade: 'ม.1' }
              ],
              'วันอังคาร': [
                { period: 1, subject: 'ภาษาไทย 6', grade: 'ป.6' },
                { period: 2, subject: null, grade: null },
                { period: 3, subject: 'ภาษาไทย', grade: 'ม.1' },
                { period: 4, subject: 'ภาษาไทย', grade: 'ม.3' },
                { period: 5, subject: 'ศิลปะ (ดนตรี)', grade: 'ม.3' },
                { period: 6, subject: 'แนะแนว', grade: 'ป.6' }
              ],
              'วันพุธ': [
                { period: 1, subject: 'ภาษาไทย', grade: 'ม.1' },
                { period: 2, subject: 'ภาษาไทย', grade: 'ม.3' },
                { period: 3, subject: null, grade: null },
                { period: 4, subject: null, grade: null },
                { period: 5, subject: 'ศิลปะ (ทัศนศิลป์)', grade: 'ม.2' },
                { period: 6, subject: 'ลูกเสือ', grade: null }
              ],
              'วันพฤหัสบดี': [
                { period: 1, subject: 'ภาษาไทย 6', grade: 'ป.6' },
                { period: 2, subject: 'ภาษาไทย', grade: 'ม.2' },
                { period: 3, subject: 'ศิลปะ (ดนตรี)', grade: 'ม.2' },
                { period: 4, subject: 'วิทยาการคำนวณ 6', grade: 'ป.6' },
                { period: 5, subject: 'ศิลปะ (ทัศนศิลป์)', grade: 'ม.1' },
                { period: 6, subject: 'ชุมนุม', grade: null }
              ],
              'วันศุกร์': [
                { period: 1, subject: 'ภาษาไทย 6', grade: 'ป.6' },
                { period: 2, subject: null, grade: null },
                { period: 3, subject: null, grade: null },
                { period: 4, subject: 'ภาษาไทย', grade: 'ม.2' },
                { period: 5, subject: null, grade: null },
                { period: 6, subject: 'PLC', grade: null }
              ]
            }
          },
          {
            name: 'ครูอมรเทพ จันทร์ครบ',
            type: 'tutor',
            canTeachGrades: [],
            canTeachSpecial: null,
            schedule: {
              'วันจันทร์': [
                { period: 1, subject: null, grade: null },
                { period: 2, subject: 'คณิตศาสตร์', grade: 'ม.1' },
                { period: 3, subject: 'คณิตศาสตร์', grade: 'ม.2' },
                { period: 4, subject: null, grade: null },
                { period: 5, subject: 'คณิตศาสตร์ 6', grade: 'ป.6' },
                { period: 6, subject: null, grade: null }
              ],
              'วันอังคาร': [
                { period: 1, subject: 'คณิตศาสตร์', grade: 'ม.2' },
                { period: 2, subject: 'คณิตศาสตร์', grade: 'ม.1' },
                { period: 3, subject: 'คณิตศาสตร์', grade: 'ม.3' },
                { period: 4, subject: null, grade: null },
                { period: 5, subject: 'คณิตศาสตร์ 6', grade: 'ป.6' },
                { period: 6, subject: null, grade: null }
              ],
              'วันพุธ': [
                { period: 1, subject: 'วางทุกงานอ่านทุกคน', grade: 'ป.6' },
                { period: 2, subject: 'คณิตศาสตร์', grade: 'ม.1' },
                { period: 3, subject: 'คณิตศาสตร์', grade: 'ม.3' },
                { period: 4, subject: null, grade: null },
                { period: 5, subject: 'คณิตศาสตร์ 6', grade: 'ป.6' },
                { period: 6, subject: 'ลูกเสือ', grade: null }
              ],
              'วันพฤหัสบดี': [
                { period: 1, subject: 'คณิตศาสตร์', grade: 'ม.2' },
                { period: 2, subject: 'คณิตศาสตร์', grade: 'ม.3' },
                { period: 3, subject: null, grade: null },
                { period: 4, subject: null, grade: null },
                { period: 5, subject: null, grade: null },
                { period: 6, subject: 'ชุมนุม', grade: null }
              ],
              'วันศุกร์': [
                { period: 1, subject: 'คณิตศาสตร์ (เพิ่มเติม)', grade: 'ม.1' },
                { period: 2, subject: 'คณิตศาสตร์ (เพิ่มเติม)', grade: 'ม.2' },
                { period: 3, subject: 'คณิตศาสตร์ (เพิ่มเติม)', grade: 'ม.3' },
                { period: 4, subject: 'วิทยาการคำนวณ', grade: 'ม.3' },
                { period: 5, subject: 'คณิตศาสตร์ 6', grade: 'ป.6' },
                { period: 6, subject: 'แนะแนว', grade: 'ม.3' }
              ]
            }
          },
          {
            name: 'ครูสายรุ้ง เรืองสุขสุด',
            type: 'tutor',
            canTeachGrades: [],
            canTeachSpecial: null,
            schedule: {
              'วันจันทร์': [
                { period: 1, subject: 'อังกฤษพื้นฐาน', grade: 'ม.2' },
                { period: 2, subject: 'อังกฤษ (เพิ่มเติม)', grade: 'ม.2' },
                { period: 3, subject: 'อังกฤษ (เพิ่มเติม)', grade: 'ม.3' },
                { period: 4, subject: 'อังกฤษพื้นฐาน', grade: 'ม.1' },
                { period: 5, subject: 'อังกฤษเพิ่มเติม 3', grade: 'ป.3' },
                { period: 6, subject: null, grade: null }
              ],
              'วันอังคาร': [
                { period: 1, subject: 'อังกฤษพื้นฐาน', grade: 'ม.1' },
                { period: 2, subject: 'อังกฤษพื้นฐาน 3', grade: 'ป.3' },
                { period: 3, subject: null, grade: null },
                { period: 4, subject: 'อังกฤษพื้นฐาน', grade: 'ม.2' },
                { period: 5, subject: 'วิทยาการคำนวณ', grade: 'ม.1' },
                { period: 6, subject: null, grade: null }
              ],
              'วันพุธ': [
                { period: 1, subject: 'อังกฤษพื้นฐาน', grade: 'ม.3' },
                { period: 2, subject: 'อังกฤษพื้นฐาน', grade: 'ม.2' },
                { period: 3, subject: null, grade: null },
                { period: 4, subject: 'อังกฤษพื้นฐาน 3', grade: 'ป.3' },
                { period: 5, subject: null, grade: null },
                { period: 6, subject: 'ลูกเสือ', grade: null }
              ],
              'วันพฤหัสบดี': [
                { period: 1, subject: 'อังกฤษพื้นฐาน 5', grade: 'ป.5' },
                { period: 2, subject: 'อังกฤษ (เพิ่มเติม)', grade: 'ม.1' },
                { period: 3, subject: 'อังกฤษพื้นฐาน', grade: 'ม.3' },
                { period: 4, subject: 'แนะแนว', grade: 'ม.1' },
                { period: 5, subject: 'อังกฤษพื้นฐาน 3', grade: 'ป.3' },
                { period: 6, subject: 'ชุมนุม', grade: null }
              ],
              'วันศุกร์': [
                { period: 1, subject: 'อังกฤษพื้นฐาน 5', grade: 'ป.5' },
                { period: 2, subject: 'อังกฤษพื้นฐาน 3', grade: 'ป.3' },
                { period: 3, subject: 'อังกฤษพื้นฐาน', grade: 'ม.1' },
                { period: 4, subject: null, grade: null },
                { period: 5, subject: 'อังกฤษพื้นฐาน', grade: 'ม.3' },
                { period: 6, subject: null, grade: null }
              ]
            }
          },
          {
            name: 'ครูอรุณลักษณ์ การกระสัง',
            type: 'tutor',
            canTeachGrades: [],
            canTeachSpecial: null,
            schedule: {
              'วันจันทร์': [
                { period: 1, subject: 'อังกฤษพื้นฐาน 1', grade: 'ป.1' },
                { period: 2, subject: 'อังกฤษพื้นฐาน 4', grade: 'ป.4' },
                { period: 3, subject: 'อังกฤษเพิ่มเติม 6', grade: 'ป.6' },
                { period: 4, subject: 'อังกฤษพื้นฐาน 2', grade: 'ป.2' },
                { period: 5, subject: 'อังกฤษเพิ่มเติม 5', grade: 'ป.5' },
                { period: 6, subject: null, grade: null }
              ],
              'วันอังคาร': [
                { period: 1, subject: 'อังกฤษพื้นฐาน 2', grade: 'ป.2' },
                { period: 2, subject: null, grade: null },
                { period: 3, subject: 'อังกฤษพื้นฐาน 6', grade: 'ป.6' },
                { period: 4, subject: 'อังกฤษเพิ่มเติม 1', grade: 'ป.1' },
                { period: 5, subject: 'วิทยาการคำนวณ 4', grade: 'ป.4' },
                { period: 6, subject: null, grade: null }
              ],
              'วันพุธ': [
                { period: 1, subject: 'อังกฤษพื้นฐาน 1', grade: 'ป.1' },
                { period: 2, subject: null, grade: null },
                { period: 3, subject: 'อังกฤษพื้นฐาน 6', grade: 'ป.6' },
                { period: 4, subject: null, grade: null },
                { period: 5, subject: 'อังกฤษพื้นฐาน 2', grade: 'ป.2' },
                { period: 6, subject: 'ลูกเสือ', grade: null }
              ],
              'วันพฤหัสบดี': [
                { period: 1, subject: null, grade: null },
                { period: 2, subject: 'อังกฤษพื้นฐาน 4', grade: 'ป.4' },
                { period: 3, subject: 'อังกฤษพื้นฐาน 2', grade: 'ป.2' },
                { period: 4, subject: 'อังกฤษพื้นฐาน 1', grade: 'ป.1' },
                { period: 5, subject: 'ซ่อมเสริม', grade: 'ป.4' },
                { period: 6, subject: 'ชุมนุม', grade: null }
              ],
              'วันศุกร์': [
                { period: 1, subject: 'อังกฤษเพิ่มเติม 2', grade: 'ป.2' },
                { period: 2, subject: 'อังกฤษเพิ่มเติม 4', grade: 'ป.4' },
                { period: 3, subject: 'วางทุกงานอ่านทุกคน', grade: 'ป.6' },
                { period: 4, subject: 'แนะแนว', grade: 'ป.4' },
                { period: 5, subject: 'อังกฤษพื้นฐาน 1', grade: 'ป.1' },
                { period: 6, subject: 'PLC', grade: null }
              ]
            }
          },

          // --- ครูทั่วไป ---
          {
            name: 'ครูวิภาวัลย์ นันท์มนัส',
            type: 'general',
            canTeachGrades: ['ป.1'],
            canTeachSpecial: null,
            schedule: {
              'วันจันทร์': [
                { period: 1, subject: null, grade: null },
                { period: 2, subject: null, grade: null },
                { period: 3, subject: 'คณิตศาสตร์ 1', grade: 'ป.1' },
                { period: 4, subject: 'แนะแนว', grade: 'ป.1' },
                { period: 5, subject: 'ภาษาไทย 1', grade: 'ป.1' },
                { period: 6, subject: 'วางทุกงานอ่านทุกคน', grade: 'ป.1' }
              ],
              'วันอังคาร': [
                { period: 1, subject: 'คณิตศาสตร์ 1', grade: 'ป.1' },
                { period: 2, subject: 'วิทยาศาสตร์และเทคฯ 1', grade: 'ป.1' },
                { period: 3, subject: null, grade: null },
                { period: 4, subject: null, grade: null },
                { period: 5, subject: 'วางทุกงานอ่านทุกคน', grade: 'ป.1' },
                { period: 6, subject: 'ภาษาไทย 1', grade: 'ป.1' }
              ],
              'วันพุธ': [
                { period: 1, subject: null, grade: null },
                { period: 2, subject: 'คณิตศาสตร์ 1', grade: 'ป.1' },
                { period: 3, subject: 'ภาษาไทย 1', grade: 'ป.1' },
                { period: 4, subject: 'ซ่อมเสริม', grade: 'ป.1' },
                { period: 5, subject: null, grade: null },
                { period: 6, subject: 'ลูกเสือ', grade: null }
              ],
              'วันพฤหัสบดี': [
                { period: 1, subject: null, grade: null },
                { period: 2, subject: 'ภาษาไทย 1', grade: 'ป.1' },
                { period: 3, subject: 'คณิตศาสตร์ 1', grade: 'ป.1' },
                { period: 4, subject: null, grade: null },
                { period: 5, subject: 'วิทยาการคำนวณ 1', grade: 'ป.1' },
                { period: 6, subject: 'ชุมนุม', grade: null }
              ],
              'วันศุกร์': [
                { period: 1, subject: null, grade: null },
                { period: 2, subject: 'คณิตศาสตร์ 1', grade: 'ป.1' },
                { period: 3, subject: 'ภาษาไทย 1', grade: 'ป.1' },
                { period: 4, subject: 'ป้องกันการทุจริต 1', grade: 'ป.1' },
                { period: 5, subject: null, grade: null },
                { period: 6, subject: 'PLC', grade: null }
              ]
            }
          },
          {
            name: 'ครูวิภารักษ์ อักโข',
            type: 'general',
            canTeachGrades: ['ป.2'],
            canTeachSpecial: null,
            schedule: {
              'วันจันทร์': [
                { period: 1, subject: 'คณิตศาสตร์ 2', grade: 'ป.2' },
                { period: 2, subject: 'ภาษาไทย 2', grade: 'ป.2' },
                { period: 3, subject: 'วิทยาศาสตร์และเทคฯ 2', grade: 'ป.2' },
                { period: 4, subject: null, grade: null },
                { period: 5, subject: 'แนะแนว', grade: 'ป.2' },
                { period: 6, subject: 'วิทยาการคำนวณ 2', grade: 'ป.2' }
              ],
              'วันอังคาร': [
                { period: 1, subject: null, grade: null },
                { period: 2, subject: 'คณิตศาสตร์ 2', grade: 'ป.2' },
                { period: 3, subject: 'ภาษาไทย 2', grade: 'ป.2' },
                { period: 4, subject: 'ซ่อมเสริม', grade: 'ป.2' },
                { period: 5, subject: null, grade: null },
                { period: 6, subject: 'วางทุกงานอ่านทุกคน', grade: 'ป.2' }
              ],
              'วันพุธ': [
                { period: 1, subject: 'ภาษาไทย 2', grade: 'ป.2' },
                { period: 2, subject: null, grade: null },
                { period: 3, subject: 'คณิตศาสตร์ 2', grade: 'ป.2' },
                { period: 4, subject: 'วางทุกงานอ่านทุกคน', grade: 'ป.2' },
                { period: 5, subject: null, grade: null },
                { period: 6, subject: 'ลูกเสือ', grade: null }
              ],
              'วันพฤหัสบดี': [
                { period: 1, subject: 'คณิตศาสตร์ 2', grade: 'ป.2' },
                { period: 2, subject: 'ภาษาไทย 2', grade: 'ป.2' },
                { period: 3, subject: null, grade: null },
                { period: 4, subject: null, grade: null },
                { period: 5, subject: null, grade: null },
                { period: 6, subject: 'ชุมนุม', grade: null }
              ],
              'วันศุกร์': [
                { period: 1, subject: null, grade: null },
                { period: 2, subject: 'คณิตศาสตร์ 2', grade: 'ป.2' },
                { period: 3, subject: null, grade: null },
                { period: 4, subject: 'ป้องกันการทุจริต 2', grade: 'ป.2' },
                { period: 5, subject: 'ภาษาไทย 2', grade: 'ป.2' },
                { period: 6, subject: 'PLC', grade: null }
              ]
            }
          },
          {
            name: 'ครูวิไลพร ดอกแก้ว',
            type: 'general',
            canTeachGrades: ['ป.3'],
            canTeachSpecial: null,
            schedule: {
              'วันจันทร์': [
                { period: 1, subject: 'แนะแนว', grade: 'ป.3' },
                { period: 2, subject: 'คณิตศาสตร์ 3', grade: 'ป.3' },
                { period: 3, subject: 'ภาษาไทย 3', grade: 'ป.3' },
                { period: 4, subject: 'วิทยาศาสตร์และเทคฯ 3', grade: 'ป.3' },
                { period: 5, subject: null, grade: null },
                { period: 6, subject: null, grade: null }
              ],
              'วันอังคาร': [
                { period: 1, subject: 'ภาษาไทย 3', grade: 'ป.3' },
                { period: 2, subject: null, grade: null },
                { period: 3, subject: 'คณิตศาสตร์ 3', grade: 'ป.3' },
                { period: 4, subject: null, grade: null },
                { period: 5, subject: 'วางทุกงานอ่านทุกคน', grade: 'ป.3' },
                { period: 6, subject: 'ซ่อมเสริม', grade: 'ป.3' }
              ],
              'วันพุธ': [
                { period: 1, subject: 'คณิตศาสตร์ 3', grade: 'ป.3' },
                { period: 2, subject: 'ภาษาไทย 3', grade: 'ป.3' },
                { period: 3, subject: null, grade: null },
                { period: 4, subject: null, grade: null },
                { period: 5, subject: 'วิทยาการคำนวณ 3', grade: 'ป.3' },
                { period: 6, subject: 'ลูกเสือ', grade: null }
              ],
              'วันพฤหัสบดี': [
                { period: 1, subject: 'ภาษาไทย 3', grade: 'ป.3' },
                { period: 2, subject: 'คณิตศาสตร์ 3', grade: 'ป.3' },
                { period: 3, subject: null, grade: null },
                { period: 4, subject: 'วางทุกงานอ่านทุกคน', grade: 'ป.3' },
                { period: 5, subject: null, grade: null },
                { period: 6, subject: 'ชุมนุม', grade: null }
              ],
              'วันศุกร์': [
                { period: 1, subject: 'ภาษาไทย 3', grade: 'ป.3' },
                { period: 2, subject: null, grade: null },
                { period: 3, subject: 'คณิตศาสตร์ 3', grade: 'ป.3' },
                { period: 4, subject: null, grade: null },
                { period: 5, subject: 'ป้องการทุจริต 3', grade: 'ป.3' },
                { period: 6, subject: 'PLC', grade: null }
              ]
            }
          },
          {
            name: 'ครูพจนาจ หวลระลึก',
            type: 'general',
            canTeachGrades: ['ป.4', 'ป.5', 'ป.6'],
            canTeachSpecial: null,
            schedule: {
              'วันจันทร์': [
                { period: 1, subject: null, grade: null },
                { period: 2, subject: null, grade: null },
                { period: 3, subject: null, grade: null },
                { period: 4, subject: 'ศิลปะ (ดนตรี) 6', grade: 'ป.6' },
                { period: 5, subject: null, grade: null },
                { period: 6, subject: 'ศิลปะ 3', grade: 'ป.3' }
              ],
              'วันอังคาร': [
                { period: 1, subject: null, grade: null },
                { period: 2, subject: null, grade: null },
                { period: 3, subject: 'การงานอาชีพ 1', grade: 'ป.1' },
                { period: 4, subject: 'ประวัติศาสตร์ 3', grade: 'ป.3' },
                { period: 5, subject: 'การงานอาชีพ 2', grade: 'ป.2' },
                { period: 6, subject: 'ศิลปะ (ดนตรี) 5', grade: 'ป.5' }
              ],
              'วันพุธ': [
                { period: 1, subject: 'ศิลปะ (ดนตรี) 4', grade: 'ป.4' },
                { period: 2, subject: 'ศิลปะ (ทัศนศิลป์) 5', grade: 'ป.5' },
                { period: 3, subject: 'สังคมศึกษาฯ 3', grade: 'ป.3' },
                { period: 4, subject: 'ศิลปะ (ทัศนศิลป์) 4', grade: 'ป.4' },
                { period: 5, subject: 'ศิลปะ 1', grade: 'ป.1' },
                { period: 6, subject: 'ลูกเสือ', grade: null }
              ],
              'วันพฤหัสบดี': [
                { period: 1, subject: 'สุขศึกษาและพลศึกษา 1', grade: 'ป.1' },
                { period: 2, subject: null, grade: null },
                { period: 3, subject: 'สุขศึกษาและพลศึกษา 3', grade: 'ป.3' },
                { period: 4, subject: 'สุขศึกษาและพลศึกษา 2', grade: 'ป.2' },
                { period: 5, subject: 'ศิลปะ 2', grade: 'ป.2' },
                { period: 6, subject: 'ชุมนุม', grade: null }
              ],
              'วันศุกร์': [
                { period: 1, subject: 'สังคมศึกษาฯ 1', grade: 'ป.1' },
                { period: 2, subject: 'ศิลปะ (ทัศนศิลป์) 6', grade: 'ป.6' },
                { period: 3, subject: 'สังคมศึกษาฯ 2', grade: 'ป.2' },
                { period: 4, subject: 'การงานอาชีพ 3', grade: 'ป.3' },
                { period: 5, subject: null, grade: null },
                { period: 6, subject: 'PLC', grade: null }
              ]
            }
          },
          {
            name: 'ครูวิไลวรรณ ทองคำ',
            type: 'general',
            canTeachGrades: ['ป.4', 'ป.5', 'ป.6'],
            canTeachSpecial: null,
            schedule: {
              'วันจันทร์': [
                { period: 1, subject: 'สังคมศึกษาฯ 5', grade: 'ป.5' },
                { period: 2, subject: null, grade: null },
                { period: 3, subject: 'ภาษาไทย 5', grade: 'ป.5' },
                { period: 4, subject: 'ภาษาไทย 4', grade: 'ป.4' },
                { period: 5, subject: null, grade: null },
                { period: 6, subject: 'ประวัติศาสตร์ 6', grade: 'ป.6' }
              ],
              'วันอังคาร': [
                { period: 1, subject: 'ภาษาไทย 5', grade: 'ป.5' },
                { period: 2, subject: 'ประวัติศาสตร์ 4', grade: 'ป.4' },
                { period: 3, subject: null, grade: null },
                { period: 4, subject: 'สังคมศึกษาฯ 6', grade: 'ป.6' },
                { period: 5, subject: 'ป้องกันการทุจริต 5', grade: 'ป.5' },
                { period: 6, subject: 'สังคมศึกษาฯ 4', grade: 'ป.4' }
              ],
              'วันพุธ': [
                { period: 1, subject: 'ภาษาไทย 5', grade: 'ป.5' },
                { period: 2, subject: null, grade: null },
                { period: 3, subject: 'ภาษาไทย 4', grade: 'ป.4' },
                { period: 4, subject: 'สังคมศึกษาฯ 5', grade: 'ป.5' },
                { period: 5, subject: 'ป้องกันการทุจริต 4', grade: 'ป.4' },
                { period: 6, subject: 'ลูกเสือ', grade: null }
              ],
              'วันพฤหัสบดี': [
                { period: 1, subject: null, grade: null },
                { period: 2, subject: 'สังคมศึกษาฯ 6', grade: 'ป.6' },
                { period: 3, subject: 'ภาษาไทย 4', grade: 'ป.4' },
                { period: 4, subject: 'วิทยาการคำนวณ 5', grade: 'ป.5' },
                { period: 5, subject: 'ป้องกันการทุจริต 6', grade: 'ป.6' },
                { period: 6, subject: 'ชุมนุม', grade: null }
              ],
              'วันศุกร์': [
                { period: 1, subject: 'สังคมศึกษาฯ 4', grade: 'ป.4' },
                { period: 2, subject: 'ภาษาไทย 5', grade: 'ป.5' },
                { period: 3, subject: null, grade: null },
                { period: 4, subject: 'ประวัติศาสตร์ 5', grade: 'ป.5' },
                { period: 5, subject: 'ภาษาไทย 4', grade: 'ป.4' },
                { period: 6, subject: 'PLC', grade: null }
              ]
            }
          },
          {
            name: 'ครูบรรจง หวังทรัพย์',
            type: 'general',
            canTeachGrades: ['ป.1', 'ป.2', 'ป.4', 'ป.5', 'ป.6', 'ม.1', 'ม.2', 'ม.3'],
            canTeachSpecial: null,
            schedule: {
              'วันจันทร์': [
                { period: 1, subject: null, grade: null },
                { period: 2, subject: 'ประวัติศาสตร์ 1', grade: 'ป.1' },
                { period: 3, subject: null, grade: null },
                { period: 4, subject: 'การงานอาชีพ (เพิ่มเติม)', grade: 'ม.3' },
                { period: 5, subject: 'การงานอาชีพ 4', grade: 'ป.4' },
                { period: 6, subject: 'การงานอาชีพ', grade: 'ม.2' }
              ],
              'วันอังคาร': [
                { period: 1, subject: null, grade: null },
                { period: 2, subject: 'การงานอาชีพ 6', grade: 'ป.6' },
                { period: 3, subject: 'การงานอาชีพ', grade: 'ม.2' },
                { period: 4, subject: 'การงานอาชีพ 5', grade: 'ป.5' },
                { period: 5, subject: null, grade: null },
                { period: 6, subject: 'การงานอาชีพ', grade: 'ม.3' }
              ],
              'วันพุธ': [
                { period: 1, subject: null, grade: null },
                { period: 2, subject: 'ประวัติศาสตร์ 2', grade: 'ป.2' },
                { period: 3, subject: 'การงานอาชีพ', grade: 'ม.1' },
                { period: 4, subject: 'การงานอาชีพ', grade: 'ม.3' },
                { period: 5, subject: 'การงานอาชีพ 5', grade: 'ป.5' },
                { period: 6, subject: 'ลูกเสือ', grade: null }
              ],
              'วันพฤหัสบดี': [
                { period: 1, subject: 'การงานอาชีพ 4', grade: 'ป.4' },
                { period: 2, subject: null, grade: null },
                { period: 3, subject: 'พลศึกษา', grade: 'ม.1' },
                { period: 4, subject: 'พลศึกษา', grade: 'ม.3' },
                { period: 5, subject: 'พลศึกษา', grade: 'ม.2' },
                { period: 6, subject: 'ชุมนุม', grade: null }
              ],
              'วันศุกร์': [
                { period: 1, subject: null, grade: null },
                { period: 2, subject: 'การงานอาชีพ', grade: 'ม.1' },
                { period: 3, subject: null, grade: null },
                { period: 4, subject: 'การงานอาชีพ 6', grade: 'ป.6' },
                { period: 5, subject: 'การงานอาชีพ (เพิ่มเติม)', grade: 'ม.2' },
                { period: 6, subject: 'การงานอาชีพ (เพิ่มเติม)', grade: 'ม.1' }
              ]
            }
          },
          {
            name: 'ครูเอกพจน์ หัวเขา',
            type: 'general',
            canTeachGrades: ['ม.1', 'ม.2', 'ม.3'],
            canTeachSpecial: null,
            schedule: {
              'วันจันทร์': [
                { period: 1, subject: 'สังคมศึกษาฯ', grade: 'ม.3' },
                { period: 2, subject: null, grade: null },
                { period: 3, subject: null, grade: null },
                { period: 4, subject: null, grade: null },
                { period: 5, subject: 'สังคมศึกษาฯ', grade: 'ม.1' },
                { period: 6, subject: 'ป้องกันการทุจริต', grade: 'ม.3' }
              ],
              'วันอังคาร': [
                { period: 1, subject: null, grade: null },
                { period: 2, subject: 'สังคมศึกษาฯ', grade: 'ม.3' },
                { period: 3, subject: null, grade: null },
                { period: 4, subject: null, grade: null },
                { period: 5, subject: null, grade: null },
                { period: 6, subject: 'สังคมศึกษาฯ', grade: 'ม.2' }
              ],
              'วันพุธ': [
                { period: 1, subject: null, grade: null },
                { period: 2, subject: null, grade: null },
                { period: 3, subject: 'สังคมศึกษาฯ', grade: 'ม.2' },
                { period: 4, subject: 'ป้องกันการทุจริต', grade: 'ม.2' },
                { period: 5, subject: 'สังคมศึกษาฯ', grade: 'ม.1' },
                { period: 6, subject: 'ลูกเสือ', grade: null }
              ],
              'วันพฤหัสบดี': [
                { period: 1, subject: 'ประวัติศาสตร์', grade: 'ม.1' },
                { period: 2, subject: null, grade: null },
                { period: 3, subject: null, grade: null },
                { period: 4, subject: 'ประวัติศาสตร์', grade: 'ม.2' },
                { period: 5, subject: 'ประวัติศาสตร์', grade: 'ม.3' },
                { period: 6, subject: 'ชุมนุม', grade: null }
              ],
              'วันศุกร์': [
                { period: 1, subject: 'สังคมศึกษาฯ', grade: 'ม.3' },
                { period: 2, subject: null, grade: null },
                { period: 3, subject: 'สังคมศึกษาฯ', grade: 'ม.2' },
                { period: 4, subject: 'สังคมศึกษาฯ', grade: 'ม.1' },
                { period: 5, subject: 'ป้องกันการทุจริต', grade: 'ม.1' },
                { period: 6, subject: 'แนะแนว', grade: 'ม.2' }
              ]
            }
          },
          {
            name: 'ครูกฤติยา ศรีเพชร',
            type: 'general',
            canTeachGrades: ['ม.1', 'ม.2', 'ม.3'],
            canTeachSpecial: null,
            schedule: {
              'วันจันทร์': [
                { period: 1, subject: 'คณิตศาสตร์ 4', grade: 'ป.4' },
                { period: 2, subject: 'คณิตศาสตร์ 5', grade: 'ป.5' },
                { period: 3, subject: null, grade: null },
                { period: 4, subject: null, grade: null },
                { period: 5, subject: null, grade: null },
                { period: 6, subject: 'วางทุกงานอ่านทุกคน', grade: 'ป.4' }
              ],
              'วันอังคาร': [
                { period: 1, subject: 'สุขศึกษา', grade: 'ม.3' },
                { period: 2, subject: 'คณิตศาสตร์ 5', grade: 'ป.5' },
                { period: 3, subject: 'คณิตศาสตร์ 4', grade: 'ป.4' },
                { period: 4, subject: 'วางทุกงานอ่านทุกคน', grade: 'ป.4' },
                { period: 5, subject: 'วิทยาการคำนวณ', grade: 'ม.2' },
                { period: 6, subject: 'สุขศึกษา', grade: 'ม.1' }
              ],
              'วันพุธ': [
                { period: 1, subject: 'สุขศึกษา', grade: 'ม.2' },
                { period: 2, subject: 'คณิตศาสตร์ 4', grade: 'ป.4' },
                { period: 3, subject: 'คณิตศาสตร์ 5', grade: 'ป.5' },
                { period: 4, subject: 'ซ่อมเสริม', grade: 'ป.6' },
                { period: 5, subject: null, grade: null },
                { period: 6, subject: 'ลูกเสือ', grade: null }
              ],
              'วันพฤหัสบดี': [
                { period: 1, subject: null, grade: null },
                { period: 2, subject: 'คณิตศาสตร์ 5', grade: 'ป.5' },
                { period: 3, subject: 'สุขศึกษาและพลศึกษา 6', grade: 'ป.6' },
                { period: 4, subject: null, grade: null },
                { period: 5, subject: null, grade: null },
                { period: 6, subject: 'ชุมนุม', grade: null }
              ],
              'วันศุกร์': [
                { period: 1, subject: null, grade: null },
                { period: 2, subject: null, grade: null },
                { period: 3, subject: 'คณิตศาสตร์ 4', grade: 'ป.4' },
                { period: 4, subject: null, grade: null },
                { period: 5, subject: 'แนะแนว', grade: 'ป.5' },
                { period: 6, subject: null, grade: null }
              ]
            }
          },
          {
            name: 'ครูคีร่า โอคอนเนล',
            type: 'general',
            canTeachGrades: [], // สอนเฉพาะอังกฤษ
            canTeachSpecial: { subject: 'อังกฤษ', grades: ['ป.1', 'ป.2', 'ป.3', 'ป.4', 'ป.5', 'ป.6', 'ม.1', 'ม.2', 'ม.3'] },
            schedule: {
              'วันจันทร์': [
                { period: 1, subject: 'อังกฤษพื้นฐาน', grade: 'ม.2' },
                { period: 2, subject: 'อังกฤษพื้นฐาน 4', grade: 'ป.4' },
                { period: 3, subject: null, grade: null },
                { period: 4, subject: 'อังกฤษพื้นฐาน 2', grade: 'ป.2' },
                { period: 5, subject: null, grade: null },
                { period: 6, subject: null, grade: null }
              ],
              'วันอังคาร': [
                { period: 1, subject: 'อังกฤษพื้นฐาน', grade: 'ม.1' },
                { period: 2, subject: 'อังกฤษพื้นฐาน 3', grade: 'ป.3' },
                { period: 3, subject: 'อังกฤษพื้นฐาน 6', grade: 'ป.6' },
                { period: 4, subject: null, grade: null },
                { period: 5, subject: null, grade: null },
                { period: 6, subject: null, grade: null }
              ],
              'วันพุธ': [
                { period: 1, subject: 'อังกฤษพื้นฐาน 1', grade: 'ป.1' },
                { period: 2, subject: null, grade: null },
                { period: 3, subject: 'อังกฤษพื้นฐาน 6', grade: 'ป.6' },
                { period: 4, subject: null, grade: null },
                { period: 5, subject: 'อังกฤษพื้นฐาน 2', grade: 'ป.2' },
                { period: 6, subject: 'ลูกเสือ', grade: null }
              ],
              'วันพฤหัสบดี': [
                { period: 1, subject: 'อังกฤษพื้นฐาน 5', grade: 'ป.5' },
                { period: 2, subject: 'อังกฤษพื้นฐาน 4', grade: 'ป.4' },
                { period: 3, subject: 'อังกฤษพื้นฐาน', grade: 'ม.3' },
                { period: 4, subject: null, grade: null },
                { period: 5, subject: null, grade: null },
                { period: 6, subject: 'ชุมนุม', grade: null }
              ],
              'วันศุกร์': [
                { period: 1, subject: 'อังกฤษพื้นฐาน 5', grade: 'ป.5' },
                { period: 2, subject: 'อังกฤษพื้นฐาน 3', grade: 'ป.3' },
                { period: 3, subject: null, grade: null },
                { period: 4, subject: null, grade: null },
                { period: 5, subject: 'อังกฤษพื้นฐาน 1', grade: 'ป.1' },
                { period: 6, subject: 'PLC', grade: null }
              ]
            }
          }
        ];

        // --- HELPER FUNCTIONS ---

        const EXCLUDED_SUBJECTS = ['ลูกเสือ', 'ชุมนุม', 'PLC'];
        const TUTORING_GRADES = ['ป.6', 'ม.3'];
        const PERIOD_TIMES = { // Define period start/end times if needed for display
            1: "08:00 - 09:00", 2: "09:00 - 10:00", 3: "10:30 - 11:30",
            4: "12:30 - 13:30", 5: "13:30 - 14:30", 6: "15:00 - 16:00"
            // Adjust these times as per actual school schedule if different from O-NET blocks
        };

        function formatDateToKey(dateString) {
          if (!dateString) return null;
          const [year, month, day] = dateString.split('-');
          const buddhistYear = parseInt(year) + 543;
          return `${day}/${month}/${buddhistYear}`;
        }
		
		function dateKeyToDate(dateKey) {
    if (!dateKey) return null;
    const [day, month, year] = dateKey.split('/');
    const gregorianYear = parseInt(year) - 543;
    // month - 1 เพราะ JavaScript นับเดือนจาก 0-11
    return new Date(gregorianYear, parseInt(month) - 1, parseInt(day));
}

        function getDayOfWeek(dateKey) {
          if (!dateKey) return null;
          const [day, month, year] = dateKey.split('/');
          const gregorianYear = parseInt(year) - 543;
          const date = new Date(`${gregorianYear}-${month}-${day}`);
          const dayIndex = date.getDay();
          const days = ['วันอาทิตย์', 'วันจันทร์', 'วันอังคาร', 'วันพุธ', 'วันพฤหัสบดี', 'วันศุกร์', 'วันเสาร์'];
          return days[dayIndex];
        }

        function canTeacherSubstitute(teacher, targetGrade, targetSubject) {
            if (!targetGrade) return true;
            if (!targetSubject) return false; // Added check for null subject

            // Handle special subject teacher (e.g., English only)
            if (teacher.canTeachSpecial) {
                const { subject, grades } = teacher.canTeachSpecial;
                if (targetSubject.toLowerCase().includes(subject.toLowerCase())) {
                    if (grades.includes(targetGrade)) {
                        return true;
                    }
                }
            }

            // Handle general grade teacher
            if (teacher.canTeachGrades.includes(targetGrade)) {
                return true;
            }

            return false;
        }


        function isGradeTutoring(grade, period, onetDaySchedule) {
          if (!TUTORING_GRADES.includes(grade) || !onetDaySchedule) {
            return false;
          }
          for (const session of onetDaySchedule) {
            if (session.grade === grade && session.periods.includes(period)) {
              return true;
            }
          }
          return false;
        }

        function isTeacherTutoring(teacherName, period, onetDaySchedule) {
            if (!onetDaySchedule) {
                return false;
            }
            for (const session of onetDaySchedule) {
                if (session.teacher === teacherName && session.periods.includes(period)) {
                    return true;
                }
            }
            return false;
        }

function parseGradeToNumber(grade) {
            if (!grade || typeof grade !== 'string') return 0;
            const num = parseInt(grade.replace(/\D/g, ''));
            if (isNaN(num)) return 0;
            if (grade.startsWith('ม')) return num + 6; // ป.6 = 6, ม.1 = 7
            return num; // ป.1 = 1, ป.5 = 5
        }

        function getGradeProximity(teacherGrades, targetGrade) {
            const targetNum = parseGradeToNumber(targetGrade);
            if (targetNum === 0) return 99; // Cannot compare
            if (!teacherGrades || teacherGrades.length === 0) return 99; // Teacher has no specified grades

            let minDiff = Infinity;
            for (const g of teacherGrades) {
                const diff = Math.abs(parseGradeToNumber(g) - targetNum);
                if (diff < minDiff) {
                    minDiff = diff;
                }
            }
            return minDiff;
        }
		
		function isTeacherP1toP3Only(teacher) {
            // ถ้าครูไม่มี canTeachGrades (เช่น ครูสอนภาษา) ให้ถือว่าไม่ใช
            if (!teacher.canTeachGrades || teacher.canTeachGrades.length === 0) {
                return false; 
            }
            
            // ตรวจสอบว่า "ทุกระดับชั้น" ที่ครูสอนได้ อยู่ในช่วง ป.1 - ป.3 หรือไม่
            return teacher.canTeachGrades.every(grade => {
                const gradeNum = parseGradeToNumber(grade); // ป.1=1, ป.2=2, ป.3=3
                return gradeNum >= 1 && gradeNum <= 3;
            });
        }

        function generateSchedules(dateKey) {
            const onetDaySchedule = onetData[dateKey];
            const dayOfWeek = getDayOfWeek(dateKey);

            const initialResult = {
                teacherSchedule: [],
                studentScheduleByGrade: {}, // { 'ป.1': [{period, subject, teacher}], ... }
                fullDateText: '',
                dayOfWeekText: dayOfWeek || ''
            };

            if (!onetDaySchedule || !dayOfWeek) {
                return initialResult; // No O-NET on this day
            }

            const [day, monthIndex, year] = dateKey.split('/');
            const thaiMonths = [ /* ... month names ... */ 'มกราคม', 'กุมภาพันธ์', 'มีนาคม', 'เมษายน', 'พฤษภาคม', 'มิถุนายน', 'กรกฎาคม', 'สิงหาคม', 'กันยายน', 'ตุลาคม', 'พฤศจิกายน', 'ธันวาคม'];
            initialResult.fullDateText = `วันที่ ${parseInt(day)} ${thaiMonths[parseInt(monthIndex) - 1]} ${year}`;
            initialResult.dayOfWeekText = dayOfWeek;

            // 1. Initialize teacher workloads and track original schedule
            const teacherWorkloads = {};
            const finalPeriodAssignments = {}; // { 1: { 'ป.1': { subject, teacher }, 'ป.2': {...} }, 2: {...} }

            allTeacherData.forEach(teacher => {
                let baseWorkload = 0;
                const normalSchedule = teacher.schedule[dayOfWeek];
                if (normalSchedule) {
                    normalSchedule.forEach(cls => {
                        // Track original assignment
                        if (!finalPeriodAssignments[cls.period]) finalPeriodAssignments[cls.period] = {};
                        if(cls.grade && cls.subject && !EXCLUDED_SUBJECTS.includes(cls.subject)) {
                             finalPeriodAssignments[cls.period][cls.grade] = { subject: cls.subject, teacher: teacher.name, originalTeacher: teacher.name };
                        }

                        // Calculate initial workload (excluding classes during own O-NET or where students are away)
                        if (cls.subject && !EXCLUDED_SUBJECTS.includes(cls.subject)) {
                            if (!isGradeTutoring(cls.grade, cls.period, onetDaySchedule) && !isTeacherTutoring(teacher.name, cls.period, onetDaySchedule)) {
                                baseWorkload++;
                            }
                        }
                    });
                }
                teacherWorkloads[teacher.name] = { base: baseWorkload, onet: 0, sub: 0, total: baseWorkload };
            });

            // 2. Add O-NET tutoring workload
            onetDaySchedule.forEach(session => {
                const tutorName = session.teacher;
                if (teacherWorkloads[tutorName]) {
                    const onetHours = session.periods.length;
                    teacherWorkloads[tutorName].onet = onetHours;
                    teacherWorkloads[tutorName].total += onetHours;
                }
            });

            // 3. Find and assign substitutes
            const teacherSubSchedule = []; // For the teacher tab
            const substitutionsMade = {}; // Tracks { period: [assignedSubName, ...], ... }

            for (const session of onetDaySchedule) {
                const tutorName = session.teacher;
                const tutor = allTeacherData.find(t => t.name === tutorName);
                const onetPeriods = session.periods;

                if (!tutor) continue;

                const scheduleEntry = {
                    tutorName: tutor.name,
                    reason: `ติดติว O-NET ${session.subject} ${session.grade} เวลา ${session.time}`,
                    substitutions: []
                };

                const tutorNormalSchedule = tutor.schedule[dayOfWeek];

                for (const classToCover of tutorNormalSchedule) {
                    const period = classToCover.period;
                    const grade = classToCover.grade;
                    const subject = classToCover.subject;

                    if (!onetPeriods.includes(period) || !subject || EXCLUDED_SUBJECTS.includes(subject) || isGradeTutoring(grade, period, onetDaySchedule)) {
                        // If the class is *not* covered (e.g., P.6 students are away), clear it from final assignments IF the original teacher was this tutor
                        if (grade && finalPeriodAssignments[period]?.[grade]?.originalTeacher === tutorName) {
                           // Keep the original teacher listed, but maybe mark it differently later if needed? For now, just don't find a sub.
                           // OR delete finalPeriodAssignments[period][grade]; // If we decide to completely remove exempted classes
                        }
                        continue; // Skip finding sub if not needed
                    }


                    // --- Find Substitute ---
// --- Find Substitute (Revised Logic) ---
                    let qualifiedCandidates = [];
                    let fallbackCandidates = []; // Teachers who are vacant but not qualified

                     for (const potentialSub of allTeacherData) {
                        if (potentialSub.name === tutorName) continue; // Cannot sub self

                        // Check 1: Is teacher busy with O-NET or already subbing?
                        if (isTeacherTutoring(potentialSub.name, period, onetDaySchedule) || (substitutionsMade[period] && substitutionsMade[period].includes(potentialSub.name))) {
                            continue; // This teacher is busy
                        }
                        
                        // Check 2: Is teacher's normal schedule vacant?
                        const subScheduleSlot = potentialSub.schedule[dayOfWeek].find(s => s.period === period);
                        let isVacant = (!subScheduleSlot || !subScheduleSlot.subject || EXCLUDED_SUBJECTS.includes(subScheduleSlot.subject)) 
                                       || isGradeTutoring(subScheduleSlot?.grade, period, onetDaySchedule); // Slot is vacant OR their students are away

                        if (isVacant) {
                            const workload = teacherWorkloads[potentialSub.name].total;

                            // Check 3: Are they qualified?
                            if (canTeacherSubstitute(potentialSub, grade, subject)) {
                                qualifiedCandidates.push({ 
                                    name: potentialSub.name, 
                                    currentWorkload: workload 
                                });
                            } else {
                            // They are vacant, but not qualified. Check new P.1-P.3 rule.
                            const targetGradeNum = parseGradeToNumber(grade); // P.4=4, P.5=5, etc.
                            const isP1toP3Teacher = isTeacherP1toP3Only(potentialSub);

                            // --- กฎใหม่: ครู ป.1-3 ห้ามสอนแทน ป.4 ขึ้นไป ---
                            if (isP1toP3Teacher && targetGradeNum > 3) {
                                // ครูคนนี้สอนเฉพาะ ป.1-3 และงานสอนแทนคือ ป.4+
                                // ห้ามเพิ่มลงในรายชื่อครูสำรอง (fallback)
                            } else {
                                // ถ้าไม่เข้าข่ายกฎใหม่ ให้เพิ่มลงในรายชื่อครูสำรองตามปกติ
                                const proximity = getGradeProximity(potentialSub.canTeachGrades, grade);
                                fallbackCandidates.push({
                                    name: potentialSub.name,
                                    currentWorkload: workload,
                                    proximity: proximity
                                });
                            }
                        }
                        }
                    }

                    // --- Assign Substitute (Revised Logic) ---
                    let bestSubName = null;
                    let reason = '';
                    let newWorkload = 0;

                    if (qualifiedCandidates.length > 0) {
                        // Case 1: Found qualified subs. Sort by workload.
                        qualifiedCandidates.sort((a, b) => a.currentWorkload - b.currentWorkload);
                        bestSubName = qualifiedCandidates[0].name;
                        newWorkload = qualifiedCandidates[0].currentWorkload + 1;
                        reason = `ครูว่าง (คาบรวมน้อยสุด), คาบรวม=${newWorkload}`;

                    } else if (fallbackCandidates.length > 0) {
                        // Case 2: No qualified subs. Use fallback list.
                        // Sort by proximity, then by workload
                        fallbackCandidates.sort((a, b) => {
                            if (a.proximity !== b.proximity) {
                                return a.proximity - b.proximity; // Sort by closest grade
                            }
                            return a.currentWorkload - b.currentWorkload; // Then by lowest workload
                        });
                        bestSubName = fallbackCandidates[0].name;
                        newWorkload = fallbackCandidates[0].currentWorkload + 1;
                        reason = `มอบหมายครู (ใกล้เคียงสุด/คาบรวมน้อยสุด), คาบรวม=${newWorkload}`;
                    
                    } else {
                        // Case 3: No one is vacant.
                        reason = 'หาคนสอนแทนไม่ได้ (ทุกครูติดสอน/ติว)';
                    }

                    // --- Record the assignment (or failure) ---
                    scheduleEntry.substitutions.push({
                        period: period,
                        classInfo: `${grade || 'ไม่ระบุ'}/${subject}`,
                        subTeacher: bestSubName, // This will be null if no one was found
                        reason: reason
                    });

                    if (bestSubName) {
                        // Update workload and track assignment
                        teacherWorkloads[bestSubName].sub++;
                        teacherWorkloads[bestSubName].total++;
                        if (!substitutionsMade[period]) substitutionsMade[period] = [];
                        substitutionsMade[period].push(bestSubName);

                        // Update the final assignment for the student schedule
                        if (grade && finalPeriodAssignments[period]?.[grade]?.originalTeacher === tutorName) {
                            finalPeriodAssignments[period][grade].teacher = bestSubName; // Update teacher
                        } else if (grade) {
                            // This handles cases where the slot might have been empty initially but needs a sub (less likely with current logic but safe)
                             if(!finalPeriodAssignments[period]) finalPeriodAssignments[period] = {};
                             if(!finalPeriodAssignments[period][grade]) { // If the slot didn't exist (e.g., tutor had a free period, but it needs covering?) - This case needs re-evaluation based on exact rules. Assuming it was the tutor's class.
                                 console.warn(`Assigning sub to potentially non-existent original slot for period ${period}, grade ${grade}. Tutor: ${tutorName}`);
                                 finalPeriodAssignments[period][grade] = { subject: subject, teacher: bestSubName, originalTeacher: tutorName }; // Assume original was tutor
                             } else {
                                 console.warn(`Mismatch in finalPeriodAssignments originalTeacher for period ${period}, grade ${grade}. Tutor: ${tutorName}, Original found: ${finalPeriodAssignments[period]?.[grade]?.originalTeacher}`);
                                 finalPeriodAssignments[period][grade].teacher = bestSubName; // Overwrite anyway?
                             }
                        }
                    } else {
                         // No sub found, mark as no teacher in student schedule
                        if (grade && finalPeriodAssignments[period]?.[grade]?.originalTeacher === tutorName) {
                           finalPeriodAssignments[period][grade].teacher = null; // Mark teacher as null
                        }
                    }
                } // End loop through tutor's classes

                if (scheduleEntry.substitutions.length > 0) {
                    teacherSubSchedule.push(scheduleEntry);
                }
            } // End loop through O-NET sessions

            // 4. Build Student Schedule from finalPeriodAssignments
            const studentScheduleByGrade = {};
            const allGrades = ['ป.1', 'ป.2', 'ป.3', 'ป.4', 'ป.5', 'ป.6', 'ม.1', 'ม.2', 'ม.3']; // Define all possible grades

            allGrades.forEach(grade => {
                studentScheduleByGrade[grade] = []; // Initialize empty array for each grade
                 for (let period = 1; period <= 6; period++) {
                     const assignment = finalPeriodAssignments[period]?.[grade];
                     if (assignment) { // Check if there's an assignment for this grade and period
                        // Determine if it's a substitute
                        const isSubstitute = assignment.teacher !== assignment.originalTeacher && assignment.teacher !== null;

                         // Add to the schedule
                         studentScheduleByGrade[grade].push({
                             period: period,
                             subject: assignment.subject,
                             teacher: assignment.teacher, // Could be null if no sub found
                             isSubstitute: isSubstitute
                         });
                     } else {
                         // Add an entry for empty slots if desired, or skip
                         // studentScheduleByGrade[grade].push({ period: period, subject: '---', teacher: '---', isSubstitute: false });
                     }
                 }
                 // Sort by period just in case
                 studentScheduleByGrade[grade].sort((a, b) => a.period - b.period);
            });


            return { teacherSchedule: teacherSubSchedule, studentScheduleByGrade, fullDateText: initialResult.fullDateText, dayOfWeekText: initialResult.dayOfWeekText };
        }
		
		// --- CORE WORKLOAD SUMMARY LOGIC ---

function calculateWorkloadSummary(startDateKey, endDateKey) {
    const summary = {};
    const startDate = dateKeyToDate(startDateKey);
    const endDate = dateKeyToDate(endDateKey);

    // 1. Initialize summary object for all teachers
    allTeacherData.forEach(teacher => {
        summary[teacher.name] = {
            name: teacher.name,
            type: teacher.type,
            normal: 0,
            sub: 0,
            onet: 0,
            total: 0
        };
    });

    // 2. Iterate through all dates in onetData
    for (const dateKey in onetData) {
        const currentDate = dateKeyToDate(dateKey);

        // Check if the date is within the specified range
        if (currentDate >= startDate && currentDate <= endDate) {
            const dayOfWeek = getDayOfWeek(dateKey);
            const onetDaySchedule = onetData[dateKey];

            if (!dayOfWeek || !onetDaySchedule) continue; // Skip if no schedule or invalid day

            // 3. Calculate O-NET hours
            onetDaySchedule.forEach(session => {
                if (summary[session.teacher]) {
                    summary[session.teacher].onet += session.periods.length;
                }
            });

            // 4. Calculate Substitute hours (by running the daily schedule generator)
            const dailySchedules = generateSchedules(dateKey);
            dailySchedules.teacherSchedule.forEach(tutorEntry => {
                tutorEntry.substitutions.forEach(sub => {
                    if (sub.subTeacher && summary[sub.subTeacher]) {
                        summary[sub.subTeacher].sub += 1; // 1 sub assignment = 1 hour
                    }
                });
            });

            // 5. Calculate Normal hours (excluding P.6, M.3, and own tutoring time)
            allTeacherData.forEach(teacher => {
                const teacherName = teacher.name;
                const normalSchedule = teacher.schedule[dayOfWeek];
                if (!normalSchedule) return;

                for (let period = 1; period <= 6; period++) {
                    const cls = normalSchedule.find(s => s.period === period);

                    if (!cls || !cls.subject || !cls.grade || EXCLUDED_SUBJECTS.includes(cls.subject)) {
                        continue; // Skip if no class, no subject, or excluded subject
                    }

                    // --- APPLY EXCLUSION RULES ---

                    // Rule 1: Exclude if teacher is tutoring at this time
                    if (isTeacherTutoring(teacherName, period, onetDaySchedule)) {
                        continue; 
                    }

                    // Rule 2: Exclude if the class is P.6 or M.3 (students are at O-NET)
                    if (cls.grade === 'ป.6' || cls.grade === 'ม.3') {
                        continue;
                    }

                    // If all checks pass, it's a valid normal teaching hour
                    summary[teacherName].normal += 1;
                }
            });
        }
    }

    // 6. Calculate totals
    const summaryArray = Object.values(summary).map(teacher => {
        teacher.total = teacher.normal + teacher.sub + teacher.onet;
        return teacher;
    });

    // 7. Sort the array: Tutors first, then by total hours
    summaryArray.sort((a, b) => {
        if (a.type === 'tutor' && b.type !== 'tutor') return -1;
        if (a.type !== 'tutor' && b.type === 'tutor') return 1;
        return b.total - a.total; // Sort by total descending
    });

    return summaryArray;
}


        // --- UI Rendering ---
        const datePicker = document.getElementById('date-picker');
        // Tab elements
        const tabButtons = document.querySelectorAll('.tab-button');
        const tabContents = document.querySelectorAll('.tab-content');
        const teacherScheduleContent = document.getElementById('teacher-schedule-content');
        const studentScheduleContent = document.getElementById('student-schedule-content');
        const teacherScheduleDetails = document.getElementById('teacher-schedule-details');
        const studentScheduleDetails = document.getElementById('student-schedule-details');
        const teacherHeaderEl = document.getElementById('teacher-schedule-header');
        const studentHeaderEl = document.getElementById('student-schedule-header');
        const teacherNoDataEl = document.getElementById('teacher-schedule-nodata');
        const studentNoDataEl = document.getElementById('student-schedule-nodata');
		const summaryContent = document.getElementById('summary-content');
const summaryHeaderEl = document.getElementById('summary-schedule-header');
const summaryScheduleDetails = document.getElementById('summary-schedule-details');
const summaryNoDataEl = document.getElementById('summary-schedule-nodata');
        // Action buttons & Toast
        const exportBtn = document.getElementById('export-btn');
        const shareBtn = document.getElementById('share-btn');
        const toast = document.getElementById('toast');
        let toastTimeout;
        let currentFullSchedule = null; // Store the generated schedule
		let workloadSummaryData = null; // เพิ่มตัวแปรนี้

        function showToast(message) {
            toast.textContent = message;
            toast.classList.add('show');
            clearTimeout(toastTimeout);
            toastTimeout = setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Function to render the TEACHER substitution details
        function renderTeacherSchedule(scheduleData) {
             teacherScheduleDetails.innerHTML = '';
             teacherNoDataEl.classList.add('hidden');
             teacherHeaderEl.innerHTML = `📆 ผลการจัดตารางสอนแทน ${scheduleData.dayOfWeekText} ${scheduleData.fullDateText}`;


            if (scheduleData.teacherSchedule.length > 0) {
                scheduleData.teacherSchedule.forEach(tutorEntry => {
                    const entryDiv = document.createElement('div');
                    entryDiv.className = "bg-slate-50 p-5 rounded-lg shadow-md border border-slate-200";
                    const tutorHeader = document.createElement('h4');
                    tutorHeader.className = "text-xl font-semibold text-indigo-900 mb-4";
                    tutorHeader.innerHTML = `สอนแทน ${tutorEntry.tutorName} <span class="font-normal text-slate-700 text-base block md:inline md:ml-2">(${tutorEntry.reason})</span>`;
                    entryDiv.appendChild(tutorHeader);
                    const subList = document.createElement('ul');
                    subList.className = "list-disc list-inside space-y-3 pl-2";
                    tutorEntry.substitutions.forEach(sub => {
                        const listItem = document.createElement('li');
                        listItem.className = "text-slate-800 text-base md:text-lg";
                        let subTeacherHtml = sub.subTeacher ? `<strong class="text-green-700 ml-1">${sub.subTeacher}</strong>` : `<strong class="text-red-600 ml-1">หาคนสอนแทนไม่ได้</strong>`;
                        listItem.innerHTML = `<strong class="text-slate-900">คาบ ${sub.period}:</strong> ${sub.classInfo} → ${subTeacherHtml} <span class="text-sm text-slate-500 block md:inline md:ml-2">(${sub.reason})</span>`;
                        subList.appendChild(listItem);
                    });
                    entryDiv.appendChild(subList);
                    teacherScheduleDetails.appendChild(entryDiv);
                });
            } else {
                 teacherNoDataEl.textContent = scheduleData.dayOfWeekText ? `ไม่มีการติว O-NET หรือไม่มีคาบสอนแทนในวันนี้` : "กรุณาเลือกวันที่ที่ถูกต้อง";
                 teacherNoDataEl.classList.remove('hidden');
            }
        }

        // *** UPDATED Function to render the STUDENT schedule (Filtered) ***
        function renderStudentSchedule(scheduleData) {
             studentScheduleDetails.innerHTML = ''; // Clear previous student schedule
             studentNoDataEl.classList.add('hidden');
             studentHeaderEl.innerHTML = `🧑‍🎓 ตารางเรียน ${scheduleData.dayOfWeekText} ${scheduleData.fullDateText} (เฉพาะคาบที่มีการสอนแทน)`; // Updated Header

             const grades = Object.keys(scheduleData.studentScheduleByGrade).sort(); // Sort grades P.1, P.2... M.1...
             let hasAnySubstitution = false; // Flag to check if any grade has subs

             grades.forEach(grade => {
                 const fullGradeSchedule = scheduleData.studentScheduleByGrade[grade];
                 // Filter for substitute classes ONLY for this grade
                 const substituteClasses = fullGradeSchedule.filter(cls => cls.isSubstitute);

                 // Only proceed if this grade has substitute classes
                 if (substituteClasses.length > 0) {
                     hasAnySubstitution = true; // Mark that we found at least one sub

                     const gradeDiv = document.createElement('div');
                     gradeDiv.className = "bg-blue-50 p-5 rounded-lg shadow-md border border-blue-200 mb-4"; // Different color for student view

                     const gradeHeader = document.createElement('h4');
                     gradeHeader.className = "text-xl font-semibold text-blue-900 mb-3";
                     gradeHeader.textContent = `ระดับชั้น ${grade}`;
                     gradeDiv.appendChild(gradeHeader);

                     const classList = document.createElement('ul');
                     classList.className = "list-none space-y-2"; // Use list-none for cleaner look

                     // Iterate ONLY through the filtered substitute classes
                     substituteClasses.forEach(cls => {
                         const listItem = document.createElement('li');
                         listItem.className = "text-slate-800 text-base md:text-lg border-b border-blue-100 pb-1";

                         // Teacher name will always be substitute here
                         const teacherNameHtml = `<strong class="text-orange-600">${cls.teacher} (สอนแทน)</strong>`;

                         listItem.innerHTML = `
                             <strong class="text-blue-800 w-16 inline-block">คาบ ${cls.period}:</strong>
                             <span class="font-medium mr-2">${cls.subject}</span>
                             → ${teacherNameHtml}
                         `;
                         classList.appendChild(listItem);
                     });

                     gradeDiv.appendChild(classList);
                     studentScheduleDetails.appendChild(gradeDiv);
                 } // End if (substituteClasses.length > 0)
             }); // End forEach grade

             // Show no data message ONLY if NO grades had any substitutions
             if (!hasAnySubstitution) {
                  studentNoDataEl.textContent = scheduleData.dayOfWeekText ? `ไม่มีคาบเรียนที่มีการสอนแทนในวันนี้` : "กรุณาเลือกวันที่ที่ถูกต้อง"; // Updated no data text
                  studentNoDataEl.classList.remove('hidden');
             }
        }
				
// *** Function to render the Workload Summary table ***
function renderWorkloadSummary(summaryData) {
    summaryScheduleDetails.innerHTML = ''; // Clear previous table
    summaryNoDataEl.classList.add('hidden');
    summaryHeaderEl.textContent = `สรุปชั่วโมงสอนช่วงติว O-NET (10/11/2568 - 30/01/2569)`;

    if (!summaryData || summaryData.length === 0) {
        summaryNoDataEl.textContent = 'ไม่สามารถคำนวณข้อมูลสรุปได้';
        summaryNoDataEl.classList.remove('hidden');
        return;
    }

    // Create table structure
    const table = document.createElement('table');
    table.className = "min-w-full divide-y divide-slate-200 border border-slate-300 shadow-md rounded-lg";

    // Create Table Header
    const thead = document.createElement('thead');
    thead.className = "bg-slate-100";
    thead.innerHTML = `
        <tr>
            <th scope="col" class="px-4 py-3 text-center text-xs font-semibold text-slate-600 uppercase tracking-wider">ลำดับ</th>
            <th scope="col" class="px-6 py-3 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider">ชื่อ-สกุล</th>
            <th scope="col" class="px-4 py-3 text-center text-xs font-semibold text-slate-600 uppercase tracking-wider">สอนปกติ</th>
            <th scope="col" class="px-4 py-3 text-center text-xs font-semibold text-slate-600 uppercase tracking-wider">สอนแทน</th>
            <th scope="col" class="px-4 py-3 text-center text-xs font-semibold text-slate-600 uppercase tracking-wider">ติว O-NET</th>
            <th scope="col" class="px-4 py-3 text-center text-xs font-semibold text-slate-600 uppercase tracking-wider">รวม (ชั่วโมง)</th>
        </tr>
    `;
    table.appendChild(thead);

    // Create Table Body
    const tbody = document.createElement('tbody');
    tbody.className = "bg-white divide-y divide-slate-200";

    summaryData.forEach((teacher, index) => {
        const tr = document.createElement('tr');

        // Apply highlight for tutors
        if (teacher.type === 'tutor') {
            tr.className = "bg-indigo-50 hover:bg-indigo-100";
        } else {
             tr.className = "hover:bg-slate-50";
        }

        tr.innerHTML = `
            <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-slate-500">${index + 1}</td>
            <td class="px-6 py-3 whitespace-nowrap text-sm font-medium text-slate-900">${teacher.type === 'tutor' ? '✅ ' : ''}${teacher.name}</td>
            <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-slate-700">${teacher.normal}</td>
            <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-slate-700">${teacher.sub}</td>
            <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-slate-700">${teacher.onet}</td>
            <td class="px-4 py-3 whitespace-nowrap text-center text-sm font-bold text-indigo-800">${teacher.total}</td>
        `;
        tbody.appendChild(tr);
    });

    table.appendChild(tbody);
    summaryScheduleDetails.appendChild(table);
}

        // Main function to generate and render both schedules
        function generateAndRenderAllSchedules() {
            const selectedDateValue = datePicker.value;
            const dateKey = formatDateToKey(selectedDateValue);
            currentFullSchedule = generateSchedules(dateKey); // Store the full results

            renderTeacherSchedule(currentFullSchedule);
            renderStudentSchedule(currentFullSchedule);
        }

        // --- Tab Switching Logic ---
// --- Tab Switching Logic ---
tabButtons.forEach(button => {
    button.addEventListener('click', () => {
        // Deactivate all buttons and content
        tabButtons.forEach(btn => btn.classList.remove('active'));
        tabContents.forEach(content => content.classList.remove('active'));

        // Activate clicked button and corresponding content
        button.classList.add('active');
        const tabId = button.getAttribute('data-tab');
        document.getElementById(tabId + '-content').classList.add('active');

        // --- LOGIC ที่เพิ่มเข้ามา ---
        // If the summary tab is clicked, calculate (if not already done) and render
        if (tabId === 'summary') {
            if (workloadSummaryData === null) {
                // Show a temporary loading message if needed
                summaryHeaderEl.textContent = 'กำลังคำนวณข้อมูลสรุป...';
                summaryScheduleDetails.innerHTML = '';

                // Run calculation (use setTimeout to allow UI to update)
                setTimeout(() => {
                    workloadSummaryData = calculateWorkloadSummary("10/11/2568", "30/01/2569");
                    renderWorkloadSummary(workloadSummaryData);
                }, 50); // 50ms delay
            } else {
                // If data is already cached, just re-render it
                renderWorkloadSummary(workloadSummaryData);
            }
        }
    });
});


        // --- Event Listeners ---
        datePicker.addEventListener('change', generateAndRenderAllSchedules);

        exportBtn.addEventListener('click', async () => {
             // Target the *currently active tab's content* for export
             const activeTabContent = document.querySelector('.tab-content.active');
             // Determine which no-data element corresponds to the active tab
const isActiveTabTeacher = activeTabContent.id === 'teacher-schedule-content';
const isActiveTabStudent = activeTabContent.id === 'student-schedule-content';
const isActiveTabSummary = activeTabContent.id === 'summary-content';

const noDataElement = isActiveTabTeacher ? teacherNoDataEl : (isActiveTabStudent ? studentNoDataEl : summaryNoDataEl);
const exportFileNamePrefix = isActiveTabTeacher ? 'ตารางสอนแทน' : (isActiveTabStudent ? 'ตารางเรียน' : 'สรุปชั่วโมงสอน');


             if (!activeTabContent || !currentFullSchedule || noDataElement.offsetParent !== null ) { // Check if noDataElement is visible
                 showToast(`ไม่มี${exportFileNamePrefix}ให้ Export`);
                 return;
             }

            try {
                const canvas = await html2canvas(activeTabContent, { // Capture the active tab content
                    scale: 3,
                    useCORS: true,
                    backgroundColor: '#ffffff'
                });
                const link = document.createElement('a');
                link.download = `${exportFileNamePrefix}-${datePicker.value}.jpg`; // Dynamic filename
                link.href = canvas.toDataURL('image/jpeg', 0.95);
                link.click();

            } catch (err) {
                console.error("Error exporting image:", err);
                showToast('เกิดข้อผิดพลาดในการ Export รูปภาพ');
            }
        });

        shareBtn.addEventListener('click', async () => {
             // Target the *currently active tab's content* for sharing
             const activeTabContent = document.querySelector('.tab-content.active');
const isActiveTabTeacher = activeTabContent.id === 'teacher-schedule-content';
const isActiveTabStudent = activeTabContent.id === 'student-schedule-content';
const isActiveTabSummary = activeTabContent.id === 'summary-content';

const noDataElement = isActiveTabTeacher ? teacherNoDataEl : (isActiveTabStudent ? studentNoDataEl : summaryNoDataEl);
const shareTitlePrefix = isActiveTabTeacher ? 'ตารางสอนแทน' : (isActiveTabStudent ? 'ตารางเรียน' : 'สรุปชั่วโมงสอน');


             if (!activeTabContent || !currentFullSchedule || noDataElement.offsetParent !== null) { // Check visibility
                 showToast(`ไม่มี${shareTitlePrefix}ให้แชร์`);
                 return;
             }

             try {
                const canvas = await html2canvas(activeTabContent, { // Capture active tab
                    scale: 2,
                    backgroundColor: '#ffffff',
                    useCORS: true
                });

                canvas.toBlob(async (blob) => {
                    if (!blob) {
                        showToast('ไม่สามารถสร้างรูปภาพได้');
                        return;
                    }
                    const fileName = `${shareTitlePrefix}-${dateValue}.jpg`; // Dynamic filename
                    const file = new File([blob], fileName, { type: 'image/jpeg' });
                    const shareData = {
                        files: [file],
                        title: `${shareTitlePrefix}วันที่ ${dateValue}`, // Dynamic title
                        text: `${shareTitlePrefix}วันที่ ${dateValue}`, // Dynamic text
                    };

                    if (navigator.share && navigator.canShare && navigator.canShare(shareData)) {
                        try {
                            await navigator.share(shareData);
                            console.log('Image shared successfully');
                        } catch (err) {
                            if (err.name !== 'AbortError') {
                                console.error('Share failed:', err.message);
                                showToast('การแชร์ไม่สำเร็จ กรุณา Export แล้วแชร์ด้วยตนเอง');
                            } else {
                                console.log('Share cancelled by user');
                            }
                        }
                    } else {
                        console.warn('Cannot share files according to navigator.canShare or API not supported');
                        showToast('เบราว์เซอร์ไม่รองรับการแชร์ไฟล์รูปภาพโดยตรง กรุณา Export แล้วแชร์ด้วยตนเอง');
                    }
                }, 'image/jpeg', 0.9);

            } catch (err) {
                console.error('Error generating or sharing image:', err);
                showToast('เกิดข้อผิดพลาดในการแชร์รูปภาพ กรุณา Export แล้วแชร์ด้วยตนเอง');
            }
        });


        // Fallback copy function (not used for image share)
        function copyUsingExecCommand(text) {
             const textArea = document.createElement("textarea");
            textArea.value = text;
            textArea.style.position = "fixed";
            textArea.style.top = "0";
            textArea.style.left = "0";
            textArea.style.opacity = "0";
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    showToast('คัดลอกลิงก์ไปยังคลิปบอร์ดแล้ว');
                } else {
                     showToast('ไม่สามารถคัดลอกได้');
                }
            } catch (err) {
                 console.error('Fallback: Oops, unable to copy', err);
                 showToast('ไม่สามารถคัดลอกได้');
            }
            document.body.removeChild(textArea);
        }

        // --- Initial Load ---
        document.addEventListener('DOMContentLoaded', generateAndRenderAllSchedules); // Use the combined function

    </script>

</body>
</html>

